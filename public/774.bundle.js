"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[774],{774:(e,t,n)=>{n.r(t),n.d(t,{initDMChat:()=>d});var a=n(17),s=n(427),i=n(604);function d(e,t){let n=document.getElementById("dmContentArea");if(!n){n=document.createElement("div"),n.id="dmContentArea",n.className="text-channel-container";const e=document.getElementById("selectedDMBar");e?e.parentNode.insertBefore(n,e.nextSibling):document.body.appendChild(n)}n.innerHTML="";const d=document.createElement("div");d.id="dmMessages",d.dataset.channelId=`dm-${t}`,n.appendChild(d),d.addEventListener("click",(n=>{const i=n.target.closest(".message-avatar"),c=n.target.closest(".sender-name"),l=n.target.closest(".delete-icon");if(i){const e=i.dataset.username;e&&(0,s.Ij)(e,n)}else if(c)(0,s.Ij)(c.textContent.trim(),n);else if(l){const s=l.closest(".text-message");s&&(n.shiftKey||window.confirm("Bu mesajı silmek istediğinize emin misiniz?"))&&(e.emit("deleteDMMessage",{friend:t,messageId:s.dataset.id}),(0,a.m4)(d,s.dataset.id),(0,a.Lb)(d))}}));const c=document.getElementById("textChatInputBar");let l,m,r,o;if(c)l=c.cloneNode(!0),l.id="dmTextChatInputBar",l.classList.add("text-chat-input-bar"),m=l.querySelector("#textChannelMessageInput"),m&&(m.id="dmMessageInput"),r=l.querySelector("#sendTextMessageBtn"),r&&(r.id="dmSendButton",r.classList.remove("material-icons"),r.innerHTML='<span class="material-icons">send</span>'),o=l.querySelector("#micMessageBtn"),o&&(o.id="dmMicMessageBtn");else{l=document.createElement("div"),l.id="dmTextChatInputBar",l.className="text-chat-input-bar";const e=document.createElement("div");e.className="chat-input-wrapper";const t=document.createElement("button");t.id="attachBtn",t.className="icon-btn",t.type="button",t.innerHTML='<span class="material-icons">add</span>';const n=document.createElement("input");n.id="attachFileInput",n.type="file",n.multiple=!0,n.hidden=!0;const a=document.createElement("input");a.id="attachMediaInput",a.type="file",a.accept="image/*,video/*",a.multiple=!0,a.hidden=!0;const s=document.createElement("input");s.id="attachAudioInput",s.type="file",s.accept="audio/*",s.multiple=!0,s.hidden=!0;const i=document.createElement("input");i.id="attachGifInput",i.type="file",i.accept="image/gif",i.multiple=!0,i.hidden=!0,m=document.createElement("div"),m.id="dmMessageInput",m.className="chat-input",m.setAttribute("contenteditable","true"),m.setAttribute("data-placeholder","Bir mesaj yazın..."),o=document.createElement("span"),o.id="dmMicMessageBtn",o.className="mic-icon",o.textContent="mic",r=document.createElement("span"),r.id="dmSendButton",r.className="send-icon",r.innerHTML='<span class="material-icons">send</span>',e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(s),e.appendChild(i),e.appendChild(m),e.appendChild(o),e.appendChild(r),l.appendChild(e)}function p(){const n=(0,i.os)(m).trim();n&&e.emit("dmMessage",{friend:t,content:n},(e=>{e&&e.success?((0,i.Q0)(m),(0,i.rW)(m,o,r)):alert("Mesaj gönderilemedi.")}))}n.appendChild(l),e.emit("joinDM",{friend:t},(n=>{n&&n.success?e.emit("getDMMessages",{friend:t},(e=>{if(e.success&&e.messages){d.innerHTML="";const t=e.messages.map((e=>({id:e.id||e._id,content:e.content,timestamp:e.timestamp,user:{username:e.username}})));(0,a.Cp)(t,d)}else d.innerHTML="DM mesajları yüklenirken hata oluştu."})):d.innerHTML="DM mesajları yüklenirken hata oluştu."})),r.addEventListener("click",p),m.addEventListener("input",(()=>(0,i.rW)(m,o,r))),m.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),p())})),e.on("newDMMessage",(e=>{if(e.friend===t&&e.message){!function(e){let t=d.lastElementChild,n=null;if(t&&t.classList.contains("date-separator"))n=t.getAttribute("data-timestamp");else{let e=d.lastElementChild;for(;e&&e.classList.contains("date-separator");)e=e.previousElementSibling;e&&(n=e.getAttribute("data-timestamp"))}n&&!(0,a.gV)(n,e.timestamp)||(0,a.hB)(d,e.timestamp),(0,a.Yt)(e,d)}(e.message);const t=Array.isArray(e.message.attachments)?e.message.attachments.map((e=>e.url)).filter((e=>e&&e.startsWith("/uploads/"))):[];t.length&&window.cacheUploadUrls&&window.cacheUploadUrls(t)}})),e.on("dmMessageDeleted",(({messageId:e})=>{(0,a.m4)(d,e),(0,a.Lb)(d)}))}}}]);