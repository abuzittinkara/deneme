(()=>{"use strict";var e,t,n={427:(e,t,n)=>{n.d(t,{Ij:()=>d,fF:()=>r});let a=null,o=null,i=null;function r(e){i=e,e.on("avatarUpdated",(({username:e,avatar:t})=>{if(a&&o===e){const e=a.querySelector(".popout-avatar");e&&(e.src=t||"/images/default-avatar.png")}}))}async function d(e,t){a&&(a.remove(),a=null,o=null),o=e;const n=window.getAuthToken(),i=await fetch(`/api/user/me?username=${encodeURIComponent(e)}`,{headers:n?{Authorization:`Bearer ${n}`}:void 0});if(!i.ok)return;const r=await i.json(),d=document.createElement("div");d.className="profile-popout";const s=document.createElement("div");s.className="popout-banner",d.appendChild(s);const l=document.createElement("div");l.className="popout-avatar-wrap";const c=document.createElement("img");c.className="popout-avatar",c.src="/images/default-avatar.png",window.loadAvatar(e).then((e=>{c.src=e})),c.alt="",l.appendChild(c);const u=document.createElement("span");u.className="status-dot",l.appendChild(u),d.appendChild(l);const m=document.createElement("div");if(m.className="popout-display-name",m.textContent=r.displayName||e,d.appendChild(m),r.badges&&Array.isArray(r.badges)&&r.badges.length){const e=document.createElement("div");e.className="popout-badges",r.badges.forEach((t=>{const n=document.createElement("span");n.className="badge",n.textContent=t,e.appendChild(n)})),d.appendChild(e)}if(r.ctaLabel){const e=document.createElement("button");e.className="profile-cta-btn",e.textContent=r.ctaLabel,d.appendChild(e)}function p(e){d.contains(e.target)||y()}function w(e){"Escape"===e.key&&y()}function y(){d.parentNode&&d.parentNode.removeChild(d),document.removeEventListener("click",p),document.removeEventListener("keydown",w),a=null,o=null}document.body.appendChild(d),function(e,t,n){const a=e.offsetWidth||300,o=e.offsetHeight||200;let i=t,r=n;i+a>window.innerWidth-10&&(i=window.innerWidth-a-10),r+o>window.innerHeight-10&&(r=window.innerHeight-o-10),e.style.left=`${i}px`,e.style.top=`${r}px`}(d,t.clientX,t.clientY),document.addEventListener("click",p),document.addEventListener("keydown",w),a=d}},17:(e,t,n)=>{n.d(t,{Cp:()=>g,Lb:()=>f,Yt:()=>h,gV:()=>i,hB:()=>s,m4:()=>v,w:()=>E});var a=n(427);let o={};function i(e,t){const n=new Date(e),a=new Date(t);return n.getFullYear()!==a.getFullYear()||n.getMonth()!==a.getMonth()||n.getDate()!==a.getDate()}function r(e){const t=new Date(e),n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1);return t>=a?"Bugün "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t>=o&&t<a?"Dün "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):`${("0"+t.getDate()).slice(-2)}.${("0"+(t.getMonth()+1)).slice(-2)}.${t.getFullYear()} ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}function d(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function s(e,t){const n=document.createElement("div");n.className="date-separator",n.setAttribute("data-timestamp",new Date(t).toISOString()),n.innerHTML=`<span class="separator-text">${function(e){const t=new Date(e);return`${t.getDate()} ${["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"][t.getMonth()]} ${t.getFullYear()}`}(t)}</span>`,e.appendChild(n)}function l(e=[]){return e.length?`\n    <div class="message-attachments">\n      ${e.map((e=>{const t=e.type||"",n=e.url||"",a=e.name||n.split("/").pop(),o=e.size?function(e){if(!e&&0!==e)return"";const t=1048576;return e>=t?`${(e/t).toFixed(1)} MB`:e>=1024?`${(e/1024).toFixed(1)} KB`:`${e} B`}(e.size):"";if(t.startsWith("image/"))return`<img src="${n}" data-lightbox="${n}" alt="${a}">`;if(t.startsWith("video/"))return`<video controls data-lightbox="${n}"><source src="${n}" type="${t}"></video>`;if(t.startsWith("audio/"))return`<audio controls src="${n}"></audio>`;const i=/pdf$/i.test(t)||a.toLowerCase().endsWith(".pdf")?"picture_as_pdf":/(zip|rar|7z)/i.test(t)||a.toLowerCase().match(/\.(zip|rar|7z)$/)?"archive":"insert_drive_file";return`\n            <a class="attachment-wrapper" data-url="${n}" data-name="${a}" tabindex="0">\n              <span class="file-icon ${"picture_as_pdf"===i?"pdf":"archive"===i?"archive":"default"} material-icons">${i}</span>\n              <div class="file-text">\n                <div class="file-name">${a}</div>\n                <div class="file-info">${o}</div>\n              </div>\n            </a>\n          `})).join("")}\n    </div>`:""}function c(e){return e?e.replace(/@([A-Za-z0-9_]+)/g,'<span class="mention">@$1</span>'):""}let u=null;function m(e){"Escape"===e.key&&p()}function p(){u&&(u.style.display="none",u.classList.remove("active"),document.removeEventListener("keydown",m))}function w(e,t,n,a){return`\n    <div class="message-item" style="position: relative;">\n      <span class="delete-icon material-symbols-outlined">delete</span>\n      <div class="message-header">\n        <div class="message-avatar-container">\n          <img class="message-avatar" data-username="${t}" src="/images/default-avatar.png" alt="">\n        </div>\n        <div class="sender-info">\n          <span class="sender-name">${t}</span>\n          <span class="timestamp">${n}</span>\n        </div>\n      </div>\n      <div class="message-content ${a}">${c(e.content)}${l(e.attachments)}</div>\n    </div>\n  `}function y(e,t,n){const a=c(e.content);return`\n    <div class="message-item" style="position: relative;">\n      <span class="hover-time">${d(n)}</span>\n      <span class="delete-icon material-symbols-outlined">delete</span>\n      <div class="message-content ${t}">${a}${l(e.attachments)}</div>\n    </div>\n  `}function g(e,t){t.innerHTML="";let n=null;e.forEach(((a,d)=>{const l=a.user&&a.user.username?a.user.username:"Anon",c=new Date(a.timestamp),u=r(a.timestamp);let m="";n&&!i(n,c)||s(t,a.timestamp),n=c,m=0===d||(e[d-1].user&&e[d-1].user.username)!==l||i(e[d-1].timestamp,a.timestamp)?d===e.length-1||(e[d+1].user&&e[d+1].user.username)!==l||i(a.timestamp,e[d+1].timestamp)?"only-message":"first-message":d===e.length-1||(e[d+1].user&&e[d+1].user.username)!==l||i(a.timestamp,e[d+1].timestamp)?"last-message":"middle-message";let p="";p="only-message"===m||"first-message"===m?w(a,l,u,m):y(a,m,a.timestamp);const g=document.createElement("div");g.className=`text-message ${m}`,g.setAttribute("data-id",a.id||a._id||""),g.setAttribute("data-timestamp",new Date(a.timestamp).toISOString()),g.setAttribute("data-sender",l),l===window.username&&g.classList.add("own-message"),window.loadAvatar(l).then((e=>{const t=g.querySelector(".message-avatar");t&&(t.src=e)})),g.innerHTML=p,t.appendChild(g),o[t.dataset.channelId]={sender:l,timestamp:new Date(a.timestamp),count:1}})),t.scrollTop=t.scrollHeight}function h(e,t){const n=e.username||"Anon",a=r(e.timestamp);let d="last-message";const s=t.scrollTop+t.clientHeight>=t.scrollHeight-20,l=t.querySelectorAll(".text-message");let c=l.length>0?l[l.length-1]:null;if(c&&c.getAttribute("data-sender")===n)if(i(new Date(c.getAttribute("data-timestamp")),e.timestamp))d="only-message";else{c.classList.remove("only-message","first-message","middle-message","last-message"),c.classList.add("middle-message");const e=c.querySelector(".message-content");e&&(e.classList.remove("only-message","first-message","middle-message","last-message"),e.classList.add("middle-message")),d="last-message"}else d="only-message";let u="";u="only-message"===d?w(e,n,a,d):y(e,d,e.timestamp);const m=document.createElement("div");m.setAttribute("data-id",e.id||e._id||""),m.className=`text-message ${d}`,m.setAttribute("data-timestamp",new Date(e.timestamp).toISOString()),m.setAttribute("data-sender",n),n===window.username&&m.classList.add("own-message"),window.loadAvatar(n).then((e=>{const t=m.querySelector(".message-avatar");t&&(t.src=e)})),m.innerHTML=u,t.appendChild(m),s&&m.scrollIntoView({behavior:"smooth"}),o[t.dataset.channelId]={sender:n,timestamp:new Date(e.timestamp)}}function f(e){const t=Array.from(e.querySelectorAll(".text-message"));t.forEach(((e,n)=>{const a=t[n-1],o=t[n+1],s=e.dataset.sender,l=a?a.dataset.sender:null,c=o?o.dataset.sender:null,u=a?a.dataset.timestamp:null,m=o?o.dataset.timestamp:null,p=e.dataset.timestamp,w=a&&l===s&&!i(u,p),y=o&&c===s&&!i(p,m);let g="only-message";!w&&y?g="first-message":w&&!y?g="last-message":w&&y&&(g="middle-message");const h=e.classList.contains("first-message")?"first-message":e.classList.contains("last-message")?"last-message":e.classList.contains("middle-message")?"middle-message":"only-message";e.classList.remove("first-message","middle-message","last-message","only-message"),e.classList.add(g);const f=e.querySelector(".message-item");if(f&&g!==h)if("first-message"!==g&&"only-message"!==g||"first-message"===h||"only-message"===h){if(!("middle-message"!==g&&"last-message"!==g||"first-message"!==h&&"only-message"!==h)){const e=f.querySelector(".message-header");if(e&&e.remove(),!f.querySelector(".hover-time")){const e=document.createElement("span");e.className="hover-time",e.textContent=d(p),f.insertBefore(e,f.firstChild)}}}else{const t=f.querySelector(".hover-time");if(t&&t.remove(),!f.querySelector(".message-header")){const t=e.dataset.sender,n=document.createElement("div");n.className="message-header",n.innerHTML=`\n            <div class="message-avatar-container">\n              <img class="message-avatar" data-username="${t}" src="/images/default-avatar.png" alt="">\n            </div>\n            <div class="sender-info">\n              <span class="sender-name">${t}</span>\n              <span class="timestamp">${r(p)}</span>\n            </div>`;const a=f.querySelector(".delete-icon");a?f.insertBefore(n,a.nextSibling):f.insertBefore(n,f.firstChild),window.loadAvatar(t).then((e=>{const t=n.querySelector(".message-avatar");t&&(t.src=e)}))}}const v=e.querySelector(".message-content");v&&(v.classList.remove("first-message","middle-message","last-message","only-message"),v.classList.add(g))}))}function v(e,t){const n=e.querySelector(`.text-message[data-id="${t}"]`);if(!n)return;const a=n.previousElementSibling,o=n.nextElementSibling;n.remove(),a&&a.classList.contains("date-separator")&&(!o||o.classList.contains("date-separator"))&&a.remove(),f(e)}function E(e,t){const n=function(){let n,a=0;return(...o)=>{const i=100-(Date.now()-a),r=()=>{a=Date.now(),requestAnimationFrame((()=>function(){const n=t.scrollTop+t.clientHeight>=t.scrollHeight-5,a=window.selectedGroup,o=t.dataset.channelId;n&&a&&o&&window.channelUnreadCounts[a]&&window.channelUnreadCounts[a][o]>0&&e.emit("markChannelRead",{groupId:a,channelId:o})}(...o)))};i<=0?r():(clearTimeout(n),n=setTimeout(r,i))}}();t.addEventListener("scroll",n),e.on("textHistory",(e=>{g(e,t),n()})),e.on("newTextMessage",(e=>{if(e.channelId===t.dataset.channelId){const a=e.message;let o=t.lastElementChild,r=null;if(o&&o.classList.contains("date-separator"))r=o.getAttribute("data-timestamp");else{let e=t.lastElementChild;for(;e&&e.classList.contains("date-separator");)e=e.previousElementSibling;e&&(r=e.getAttribute("data-timestamp"))}r&&!i(r,a.timestamp)||s(t,a.timestamp),h(a,t),n();const d=Array.isArray(a.attachments)?a.attachments.map((e=>e.url)).filter((e=>e&&e.startsWith("/uploads/"))):[];d.length&&window.cacheUploadUrls&&window.cacheUploadUrls(d)}})),e.on("textMessageDeleted",(({channelId:e,messageId:n})=>{e===t.dataset.channelId&&(v(t,n),f(t))})),e.on("avatarUpdated",(({username:e,avatar:n})=>{window.userAvatars[e]=n,t.querySelectorAll(`[data-username="${e}"]`).forEach((e=>{e.src=n||"/images/default-avatar.png"}))})),t.addEventListener("click",(n=>{const o=n.target.closest(".message-avatar"),i=n.target.closest(".sender-name"),r=n.target.closest(".message-attachments img, .message-attachments video"),d=n.target.closest(".attachment-wrapper"),s=n.target.closest(".delete-icon");if(o){const e=o.dataset.username;e&&(0,a.Ij)(e,n)}else if(i)(0,a.Ij)(i.textContent.trim(),n);else if(r)!function(e){if(!u){u=document.createElement("div"),u.id="mediaLightbox",u.className="modal";const e=document.createElement("div");e.className="modal-content",e.style.background="transparent",e.style.boxShadow="none",e.style.padding="0",u.appendChild(e),u.style.display="none",u.addEventListener("click",(e=>{e.target===u&&p()})),document.body.appendChild(u)}const t=u.querySelector(".modal-content");let n;t.innerHTML="","IMG"===e.tagName?(n=document.createElement("img"),n.src=e.dataset.lightbox||e.src):(n=document.createElement("video"),n.src=e.dataset.lightbox||e.querySelector("source")?.src||e.src,n.controls=!0),t.appendChild(n),u.style.display="flex",u.classList.add("active"),document.addEventListener("keydown",m)}(r);else if(d){n.preventDefault();const e=d.dataset.url,t=d.dataset.name||"";if(n.shiftKey)window.open(e,"_blank");else{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),n.remove()}}else if(s){const a=s.closest(".text-message");a&&(n.shiftKey||window.confirm("Bu mesajı silmek istediğinize emin misiniz?"))&&(e.emit("deleteTextMessage",{channelId:t.dataset.channelId,messageId:a.dataset.id}),v(t,a.dataset.id),f(t))}}))}},604:(e,t,n)=>{function a(e){return e?(void 0!==e.value?e.value:e.innerText).replace(/\u00a0/g," "):""}function o(e){e&&(void 0!==e.value?e.value="":e.innerHTML="")}function i(e,t,n){e&&n&&(""!==a(e).trim()?(n.style.display="block",t&&(t.style.display="none")):(n.style.display="none",t&&(t.style.display="block")))}n.d(t,{Q0:()=>o,os:()=>a,rW:()=>i})}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={exports:{}};return n[e](i,i.exports,o),i.exports}o.m=n,o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>e+".bundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="test:",o.l=(n,a,i,r)=>{if(e[n])e[n].push(a);else{var d,s;if(void 0!==i)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+i){d=u;break}}d||(s=!0,(d=document.createElement("script")).charset="utf-8",d.timeout=120,o.nc&&d.setAttribute("nonce",o.nc),d.setAttribute("data-webpack",t+i),d.src=n),e[n]=[a];var m=(t,a)=>{d.onerror=d.onload=null,clearTimeout(p);var o=e[n];if(delete e[n],d.parentNode&&d.parentNode.removeChild(d),o&&o.forEach((e=>e(a))),t)return t(a)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:d}),12e4);d.onerror=m.bind(null,d.onerror),d.onload=m.bind(null,d.onload),s&&document.head.appendChild(d)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=n[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={792:0};o.f.j=(t,n)=>{var a=o.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var i=new Promise(((n,o)=>a=e[t]=[n,o]));n.push(a[2]=i);var r=o.p+o.u(t),d=new Error;o.l(r,(n=>{if(o.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;d.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",d.name="ChunkLoadError",d.type=i,d.request=r,a[1](d)}}),"chunk-"+t,t)}};var t=(t,n)=>{var a,i,[r,d,s]=n,l=0;if(r.some((t=>0!==e[t]))){for(a in d)o.o(d,a)&&(o.m[a]=d[a]);s&&s(o)}for(t&&t(n);l<r.length;l++)i=r[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunktest=self.webpackChunktest||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i={};o.r(i),o.d(i,{audioPermissionGranted:()=>I,consumeProducer:()=>q,consumers:()=>b,createTransport:()=>D,createTransportFlow:()=>N,device:()=>f,deviceIsLoaded:()=>v,joinRoom:()=>P,leaveRoomInternal:()=>R,listProducers:()=>G,localProducer:()=>S,localStream:()=>L,recvTransport:()=>C,remoteAudios:()=>k,requestMicrophoneAccess:()=>A,screenShareContainer:()=>B,screenShareVideo:()=>x,sendTransport:()=>E,setScreenShareContainer:()=>T,setScreenShareVideo:()=>M,showScreenShare:()=>$,startSfuFlow:()=>U});var r=o(17);const d={info:(...e)=>console.info(...e),warn:(...e)=>console.warn(...e),error:(...e)=>console.error(...e)};async function s(e,t,n={video:!0,audio:!0}){try{const a=await navigator.mediaDevices.getDisplayMedia({video:n.video,audio:n.audio});window.screenShareStream=a;const o=a.getVideoTracks()[0],i=await e.produce({track:o,stopTracks:!1});window.screenShareProducerVideo=i;let r=null;if(a.getAudioTracks().length>0){const t=a.getAudioTracks()[0];r=await e.produce({track:t,stopTracks:!1}),window.screenShareProducerAudio=r}return t.emit("screenShareStatusChanged",{isScreenSharing:!0}),t.emit("screenShareStarted",{producerId:i.id}),o.onended=()=>{l(t)},{videoProducer:i,audioProducer:r}}catch(e){throw console.error("Screen sharing failed:",e),e}}async function l(e){window.screenShareProducerVideo&&(await window.screenShareProducerVideo.close(),window.screenShareProducerVideo=null),window.screenShareProducerAudio&&(await window.screenShareProducerAudio.close(),window.screenShareProducerAudio=null),window.screenShareStream&&(window.screenShareStream.getTracks().forEach((e=>{e.stop(),e.enabled=!1})),window.screenShareStream=null),e.emit("screenShareStatusChanged",{isScreenSharing:!1}),e.emit("screenShareEnded"),d.info("Ekran paylaşımı tamamen durduruldu."),"undefined"!=typeof window&&window.clearScreenShareUI&&window.clearScreenShareUI()}let c=null;function u(e){const t=document.getElementById("cellBar1"),n=document.getElementById("cellBar2"),a=document.getElementById("cellBar3"),o=document.getElementById("cellBar4");let i=0;i=e>=1?e<80?4:e<150?3:e<300?2:1:0,[t,n,a,o].forEach((e=>e&&e.classList.remove("active"))),i>=1&&t&&t.classList.add("active"),i>=2&&n&&n.classList.add("active"),i>=3&&a&&a.classList.add("active"),i>=4&&o&&o.classList.add("active")}function m(e){const t=document.getElementById("pingValue"),n=document.getElementById("panelChannelName"),a=document.getElementById("panelGroupName");let o="#2dbf2d";e>=150?o="#ff0000":e>=80&&(o="#ffcc00"),t&&(t.style.color=o);const i=window.activeVoiceChannelName||"",r=document.getElementById("groupTitle"),d=window.activeVoiceGroupName||(r?r.textContent:"");a&&(a.textContent=d),n&&(n.textContent=i)}const p=.02,w=100;let y={};async function g(e,t){if(!e.getAudioTracks().length)return void console.warn("No audio tracks in MediaStream for user:",t);h(t);const n=new AudioContext,a=n.createMediaStreamSource(e),o=n.createAnalyser();o.fftSize=512,a.connect(o);const i=new Uint8Array(o.fftSize),r=setInterval((()=>{o.getByteTimeDomainData(i);let e=0;for(let t=0;t<i.length;t++){const n=(i[t]-128)/128;e+=Math.abs(n)}const n=e/i.length,a=document.getElementById(`avatar-${t}`);a&&(n>p?a.classList.add("speaking"):a.classList.remove("speaking"))}),w);y[t]={audioContext:n,analyser:o,dataArray:i,interval:r}}function h(e){y[e]&&(clearInterval(y[e].interval),y[e].audioContext.close().catch((()=>{})),delete y[e])}let f=null,v=!1,E=null,C=null,L=null,I=!1,S=null,b={},k=[],x=null,B=null;function M(e){x=e}function T(e){B=e}async function A(e,t,n){try{d.info("Mikrofon izni isteniyor...");const a={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}},o=await navigator.mediaDevices.getUserMedia(a);return d.info("Mikrofon erişimi verildi: "+o),L=o,I=!0,n&&(n.value=!0),t(),g(L,e.id),k.forEach((e=>{e.play().catch((e=>console.error("Ses oynatılamadı:",e)))})),o}catch(e){return console.error("Mikrofon izni alınamadı:",e),I=!1,n&&(n.value=!1),t(),null}}function U(e,t,n){d.info("startSfuFlow => group: "+t+" room: "+n),f||(f=new mediasoupClient.Device),L&&"ended"!==L.getAudioTracks()[0].readyState?N(e,t,n):A(e,(()=>{}),null).then((()=>{d.info("Mikrofon izni alındı, SFU akışı başlatılıyor..."),N(e,t,n)})).catch((e=>{console.error("Mikrofon izni alınamadı:",e)}))}async function N(e,t,n){const a=await D(e,t,n);if(a.error)return void console.error("createTransport error:",a.error);if(v?d.info("Device zaten yüklü."):(await f.load({routerRtpCapabilities:a.routerRtpCapabilities}),v=!0,d.info("Device yüklendi: "+f.rtpCapabilities)),E=f.createSendTransport(a),E.on("connect",(({dtlsParameters:o},i,r)=>{d.info("sendTransport connect => dtls"),e.emit("connectTransport",{groupId:t,roomId:n,transportId:a.id,dtlsParameters:o},(e=>{e&&e.error?r(e.error):i()}))})),E.on("produce",(async(o,i,r)=>{d.info("sendTransport produce => "+JSON.stringify(o)),e.emit("produce",{groupId:t,roomId:n,transportId:a.id,kind:o.kind,rtpParameters:o.rtpParameters},(e=>{e.error?r(e.error):i({id:e.producerId})}))})),L&&L.getAudioTracks().length>0){let t=L.getAudioTracks()[0];try{S=await E.produce({track:t,stopTracks:!1}),d.info("Mikrofon producer oluşturuldu: "+S.id)}catch(n){if("InvalidStateError"!==n.name)throw n;console.error("Audio track bitti, yeniden mikrofon izni isteniyor..."),await A(e,(()=>{}),null),t=L.getAudioTracks()[0],S=await E.produce({track:t,stopTracks:!1}),d.info("Yeni audio track ile producer oluşturuldu: "+S.id)}}else console.warn("Yerel ses akışı bulunamadı, producer oluşturulmayacak."),S=null;const o=await D(e,t,n);if(o.error)return void console.error("createTransport (recv) error:",o.error);C=f.createRecvTransport(o),C.on("connect",(({dtlsParameters:a},i,r)=>{d.info("recvTransport connect => dtls"),e.emit("connectTransport",{groupId:t,roomId:n,transportId:o.id,dtlsParameters:a},(e=>{e&&e.error?r(e.error):i()}))}));const i=await G(e,t,n);d.info("Mevcut producerlar: "+JSON.stringify(i));for(const a of i)a.peerId!==e.id?await q(e,t,n,a.id):d.info("Kendi producer, tüketme yapılmıyor: "+a.id);d.info("SFU akışı tamamlandı."),"function"==typeof window.setConnectionStatus&&window.setConnectionStatus("connected")}function D(e,t,n){return new Promise((a=>{e.emit("createWebRtcTransport",{groupId:t,roomId:n},(e=>{a(e)}))}))}function G(e,t,n){return new Promise((a=>{e.emit("listProducers",{groupId:t,roomId:n},(e=>{a(e||[])}))}))}async function q(e,t,n,a){if(!C)return void console.warn("consumeProducer: recvTransport yok");const o=await new Promise((o=>{e.emit("consume",{groupId:t,roomId:n,transportId:C.id,producerId:a},(e=>{o(e)}))}));if(o.error)return void console.error("consume error:",o.error);d.info("consumeProducer parametreleri: "+JSON.stringify(o));const i=await C.consume({id:o.id,producerId:o.producerId,kind:o.kind,rtpParameters:o.rtpParameters});if(i.appData={peerId:o.producerPeerId},b[i.id]=i,"audio"===i.kind){const{track:e}=i,t=document.createElement("audio");t.srcObject=new MediaStream([e]),t.autoplay=!0,t.dataset.peerId=i.appData.peerId,k.push(t),t.play().catch((e=>console.error("Ses oynatılamadı:",e))),g(t.srcObject,i.appData.peerId),d.info("Yeni audio consumer oluşturuldu: "+i.id+" -> konuşan: "+i.appData.peerId),"function"==typeof window.setConnectionStatus&&window.setConnectionStatus("connected")}else"video"===i.kind&&d.info("Video consumer alındı, ekran paylaşım için tıklama ile consume edilecek. Producer: "+o.producerId)}function R(e){x&&x.dataset.peerId&&e.emit("stopWatching",{userId:x.dataset.peerId}),(window.screenShareProducerVideo||window.screenShareStream)&&l(e),S&&(S.close(),S=null),E&&(E.close(),E=null),C&&(C.close(),C=null);for(const e in b)h(b[e].appData.peerId);b={},k.forEach((e=>{try{e.pause()}catch(e){}e.srcObject=null})),k=[],"undefined"!=typeof window&&(window.currentRoom=null,window.currentRoomType=null,void 0!==window.activeVoiceChannelName&&(window.activeVoiceChannelName=""),void 0!==window.activeVoiceGroupName&&(window.activeVoiceGroupName="")),d.info("leaveRoomInternal: SFU transportlar kapatıldı")}function P(e,t,n,a,o,i,r,d){e.emit("joinRoom",{groupId:t,roomId:n}),i&&(i.textContent=a),window.activeVoiceChannelName=a,"string"==typeof o&&(window.activeVoiceGroupName=o),m(0),r&&r(),d&&(d.value="voice")}async function $(e,t,n,a,o){if(!C)return void console.warn("recvTransport yok");o();const i=await new Promise((o=>{e.emit("consume",{groupId:t,roomId:n,transportId:C.id,producerId:a},(e=>{o(e)}))}));if(i.error)return void console.error("consume error:",i.error);const r=await C.consume({id:i.id,producerId:i.producerId,kind:i.kind,rtpParameters:i.rtpParameters});if(r.appData={peerId:i.producerPeerId},b[r.id]=r,"audio"===r.kind){const{track:e}=r,t=document.createElement("audio");t.srcObject=new MediaStream([e]),t.autoplay=!0,t.dataset.peerId=r.appData.peerId,k.push(t),t.play().catch((e=>console.error("Ses oynatılamadı:",e))),g(t.srcObject,r.appData.peerId)}else if("video"===r.kind){x=document.createElement("video"),x.srcObject=new MediaStream([r.track]),x.autoplay=!0,x.dataset.peerId=r.appData.peerId,window.broadcastingUserId=r.appData.peerId;const t=()=>{r.close(),delete b[r.id];for(const e in b){const t=b[e];if("audio"===t.kind&&t.appData.peerId===r.appData.peerId){t.close(),h(t.appData.peerId),delete b[e];const n=k.findIndex((e=>e.dataset.peerId===t.appData.peerId));if(-1!==n){const e=k[n];try{e.pause()}catch(e){}e.srcObject=null,k.splice(n,1)}}}B&&B.parentNode&&B.parentNode.removeChild(B),e.emit("stopWatching",{userId:r.appData.peerId}),x=null,B=null,window.broadcastingUserId=null,window.latestChannelsData&&window.currentRoom&&"function"==typeof window.renderVoiceChannelGrid&&window.latestChannelsData[window.currentRoom]&&window.renderVoiceChannelGrid(window.latestChannelsData[window.currentRoom].users),"function"==typeof window.clearScreenShareUI&&window.clearScreenShareUI()};B=function(e,t){const n=document.createElement("div");n.classList.add("screen-share-container"),n.appendChild(e);const a=document.createElement("span");if(a.classList.add("material-icons","fullscreen-icon"),a.textContent="fullscreen",a.addEventListener("click",(()=>{n.requestFullscreen&&n.requestFullscreen()})),n.appendChild(a),"function"==typeof t){const e=document.createElement("span");e.classList.add("material-icons","screen-share-end-icon"),e.textContent="call_end",e.style.display="none",n.appendChild(e),n.addEventListener("mouseenter",(()=>{e.style.display="block"})),n.addEventListener("mouseleave",(()=>{e.style.display="none"})),e.addEventListener("click",t)}return n}(x,t),function(){const e=document.getElementById("screenShareEndedMessage");e&&e.parentNode&&e.parentNode.removeChild(e)}(),e.emit("startWatching",{userId:r.appData.peerId});const n=document.getElementById("channelUsersContainer");if(n){const e=n.querySelector(`.user-card[data-user-id="${r.appData.peerId}"]`);e&&(n.classList.add("broadcast-mode"),n.style.display="flex",n.style.flexDirection="column",n.style.justifyContent="space-between",n.style.gridTemplateColumns="",n.style.gridAutoRows="",e.classList.add("broadcast-card"),e.appendChild(B))}window.latestChannelsData&&window.currentRoom&&window.renderVoiceChannelGrid(window.latestChannelsData[window.currentRoom].users),d.info("Yeni video consumer oluşturuldu: "+r.id+" -> yayıncı: "+r.appData.peerId),"function"==typeof window.setConnectionStatus&&window.setConnectionStatus("connected")}}var z=o(604);let H=[],j=null,O=0,_=null,V=null;function F(){return H.slice()}function W(){H=[];const e=document.getElementById("attachmentPreview");e&&(e.innerHTML=""),e&&(e.style.display="none"),_&&(_.style.display="none",V&&(V.value=""));const t=document.getElementById("textMessages");t&&(t.style.display=""),j&&(document.removeEventListener("click",j),j=null)}function Y(e,t){const n=document.querySelector(`#attachmentPreview .preview-item[data-index="${e}"]`);if(n){n.classList.add("upload-failed");const e=n.querySelector(".retry-btn");e&&(e.style.display="block",t&&(e.onclick=t))}}let K=[],J=null,X=-1,Q=null;function Z(){J&&(J.style.display="none",J.innerHTML="",X=-1)}function ee(){J&&J.querySelectorAll(".mention-dropdown-item").forEach(((e,t)=>{t===X?e.classList.add("active"):e.classList.remove("active")}))}function te(e){if(!Q)return;const t=window.getSelection();if(!t||!t.rangeCount)return;const n=t.getRangeAt(0);n.deleteContents();const a=document.createElement("span");a.className="mention",a.textContent=`@${e}`,n.insertNode(a);const o=document.createTextNode(" ");a.after(o),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n),Z()}function ne(e){const{loginScreen:t,registerScreen:n,groupDropdownIcon:a,groupDropdownMenu:o,copyGroupIdBtn:i,createGroupButton:r,createChannelBtn:d,groupSettingsBtn:c,leaveGroupBtn:u,toggleDMButton:p,roomPanel:w,rightPanel:y,leaveButton:g,micToggleButton:h,deafenToggleButton:f,settingsButton:v,sendTextMessageBtn:C,micMessageBtn:L,textChannelMessageInput:I,screenShareButton:S,screenShareLargeButton:b,toggleUserListButton:k,channelContentArea:x,selectedChannelTitle:B,textChannelContainer:M,groupModal:T,modalGroupCreateBtn:A,modalGroupJoinBtn:U,actualGroupCreateModal:N,actualGroupName:D,actualGroupNameBtn:G,closeCreateGroupModal:q,joinGroupModal:R,joinGroupIdInput:P,joinGroupIdBtn:$,closeJoinGroupModal:H,groupSettingsModal:j,closeGroupSettingsModal:O,userSettingsPage:_,closeUserSettingsPageBtn:V,roomModal:ne,modalRoomName:ae,textChannel:oe,voiceChannel:ie,modalCreateRoomBtn:re,modalCloseRoomBtn:de,createCategoryBtn:se,categoryModal:le,modalCategoryName:ce,modalCreateCategoryBtn:ue,modalCloseCategoryBtn:me,createChannelTargetCategory:pe}=window;window.createChannelTargetCategory??=null,function(e){e.on("groupUsers",(e=>{const t=[];e&&e.online&&t.push(...e.online.map((e=>({username:e.username,avatar:e.avatar})))),e&&e.offline&&t.push(...e.offline.map((e=>({username:e.username,avatar:e.avatar})))),K=t}))}(e);const we="rightPanelOpen";function ye(e){e?(y.style.display="flex",y.offsetWidth,requestAnimationFrame((()=>y.classList.remove("collapsed")))):(y.classList.add("collapsed"),y.addEventListener("transitionend",(function e(t){"width"===t.propertyName&&(y.style.display="none",y.removeEventListener("transitionend",e))})))}function ge(){const t=document.getElementById("previewWrapper"),n=t?.querySelector(".caption-input"),a=t&&"none"!==t.style.display?n?.value.trim()||"":(0,z.os)(I).trim(),o=F();if(!a&&0===o.length)return;if(0===o.length)return e.emit("textMessage",{groupId:window.selectedGroup,roomId:window.currentTextChannel,message:a,username:window.username}),(0,z.Q0)(I),n&&(n.value=""),C.style.display="none",void(L&&(L.style.display="block"));const i=new FormData;i.append("username",window.username||""),i.append("channelId",window.currentTextChannel),i.append("content",a),o.forEach((e=>i.append("files",e.file)));const r=o.map((e=>e.file.size)),d=[];r.reduce(((e,t,n)=>(d[n]=e,e+t)),0);const s=new XMLHttpRequest;s.upload.onprogress=e=>{const t=e.loaded;r.forEach(((e,n)=>{const a=d[n];let o=0;t>=a+e?o=100:t>a&&(o=(t-a)/e*100),function(e,t){const n=document.querySelector(`#attachmentPreview .preview-item[data-index="${e}"] .bar`);n&&(n.style.width=`${t}%`)}(n,o)}))},s.onload=()=>{if(s.status>=200&&s.status<300){let e={};try{e=JSON.parse(s.responseText)}catch{}W(),(0,z.Q0)(I),n&&(n.value=""),t&&(t.style.display="none"),C.style.display="none",L&&(L.style.display="block")}else o.forEach(((e,t)=>Y(t,ge)))},s.onerror=()=>{o.forEach(((e,t)=>Y(t,ge)))},s.open("POST","/api/message"),s.send(i)}(()=>{try{return"0"!==localStorage.getItem(we)}catch(e){return!0}})()?y.style.display="flex":(y.classList.add("collapsed"),y.style.display="none"),a&&a.addEventListener("click",(e=>{e.stopPropagation(),"none"!==o.style.display&&o.style.display?o.style.display="none":o.style.display="flex"})),document.addEventListener("click",(e=>{o&&"none"!==o.style.display&&!o.contains(e.target)&&e.target!==a&&(o.style.display="none")})),i&&i.addEventListener("click",(()=>{const e=window.selectedGroup||window.currentGroup;e&&navigator.clipboard.writeText(e),o&&(o.style.display="none")})),d&&d.addEventListener("click",(()=>{window.createChannelTargetCategory=null,ne&&(ne.style.display="flex",ne.classList.add("active")),o&&(o.style.display="none")})),se&&se.addEventListener("click",(()=>{le&&(le.style.display="flex",le.classList.add("active")),o&&(o.style.display="none")})),de&&de.addEventListener("click",(()=>{ne&&(ne.style.display="none",ne.classList.remove("active"))})),me&&me.addEventListener("click",(()=>{le&&(le.style.display="none",le.classList.remove("active"))})),re&&re.addEventListener("click",(()=>{const t=ae?ae.value.trim():"";if(!t)return;const n=ie&&ie.checked?"voice":"text";e.emit("createChannel",{groupId:window.selectedGroup,name:t,type:n,categoryId:window.createChannelTargetCategory}),window.createChannelTargetCategory=null,ae.value="",ne&&(ne.style.display="none",ne.classList.remove("active"))})),ue&&ue.addEventListener("click",(()=>{const t=ce?ce.value.trim():"";t&&(e.emit("createCategory",{groupId:window.selectedGroup,name:t}),ce.value="",le&&(le.style.display="none",le.classList.remove("active")))})),c&&c.addEventListener("click",(()=>{j&&"none"!==c.style.display&&(j.style.display="flex",j.classList.add("active"),document.body.style.overflow="hidden"),o&&(o.style.display="none")})),u&&u.addEventListener("click",(()=>{window.selectedGroup&&e.emit("leaveGroup",window.selectedGroup),o&&(o.style.display="none")})),r&&r.addEventListener("click",(()=>{T&&(T.style.display="flex",T.classList.add("active"))})),A&&A.addEventListener("click",(()=>{T&&(T.style.display="none",T.classList.remove("active")),N&&(N.style.display="flex",N.classList.add("active"))})),U&&U.addEventListener("click",(()=>{T&&(T.style.display="none",T.classList.remove("active")),R&&(R.style.display="flex",R.classList.add("active"))})),q&&q.addEventListener("click",(()=>{N&&(N.style.display="none",N.classList.remove("active"))})),H&&H.addEventListener("click",(()=>{R&&(R.style.display="none",R.classList.remove("active"))})),O&&O.addEventListener("click",(()=>{j&&(j.style.display="none",j.classList.remove("active")),document.body.style.overflow=""})),V&&V.addEventListener("click",(()=>{"function"==typeof window.closeUserSettings&&window.closeUserSettings()})),G&&G.addEventListener("click",(()=>{const t=D?D.value.trim():"";if(!t)return;const n=prompt("Metin kanalı adı:","general");n&&""!==n.trim()&&(e.emit("createGroup",{groupName:t,channelName:n.trim()}),D.value="",N&&(N.style.display="none"))})),$&&$.addEventListener("click",(()=>{const t=P?P.value.trim():"";t&&(e.emit("joinGroup",t),P.value="",R&&(R.style.display="none"))})),p.addEventListener("click",(()=>{window.removeScreenShareEndedMessage();const e=document.getElementById("channelContentArea"),t=document.getElementById("selectedChannelBar"),n=document.getElementById("selectedDMBar"),a=document.getElementById("dmContentArea"),o=document.getElementById("dmPanel");if(window.isDMMode){w.style.display="flex",e.style.display="flex",ye((()=>{try{return"0"!==localStorage.getItem(we)}catch(e){return!0}})()),n.style.display="none",a.style.display="none",o.style.display="none",t.style.display="flex",p.querySelector(".material-icons").textContent="forum",B.textContent="Kanal Seçilmedi",window.isDMMode=!1;const i=document.getElementById("textMessages"),r=document.getElementById("textChannelMessageInput"),d=document.getElementById("textChatInputBar");i&&(i.style.width=""),r&&(r.style.width=""),d&&(d.style.width="")}else w.style.display="none",e.style.display="none",ye(!1),t.style.display="none",n.style.display="flex",a.style.display="flex",o.style.display="block",p.querySelector(".material-icons").textContent="group",window.isDMMode=!0})),k&&k.addEventListener("click",(()=>{!function(e){ye(e);try{localStorage.setItem(we,e?"1":"0")}catch(e){}}(!!y.classList.contains("collapsed"))})),g&&g.addEventListener("click",(()=>{if(window.clearScreenShareUI(),!window.currentRoom)return;e.emit("leaveRoom",{groupId:window.currentGroup,roomId:window.currentRoom}),window.leaveRoomInternal(e),window.activeVoiceChannelName="",window.activeVoiceGroupName="",m(0),"function"==typeof window.hideVoiceSections&&window.hideVoiceSections();const t=document.getElementById("channelUsersContainer");if(t&&(t.innerHTML=""),document.querySelectorAll(".channel-item").forEach((e=>e.classList.remove("connected"))),e.emit("browseGroup",window.currentGroup),window.currentTextChannel){const e=document.querySelector(`.channel-item[data-room-id="${window.currentTextChannel}"]`);if(e){e.classList.add("connected");const t=e.querySelector(".channel-header .channel-name");t&&(B.textContent=t.textContent),M.style.display="flex",M.style.flexDirection="column"}}})),h.addEventListener("click",(()=>{window.micEnabled=!window.micEnabled,window.applyAudioStates()})),f.addEventListener("click",(()=>{window.selfDeafened?(window.selfDeafened=!1,window.micWasEnabledBeforeDeaf&&(window.micEnabled=!0)):(window.micWasEnabledBeforeDeaf=window.micEnabled,window.selfDeafened=!0,window.micEnabled=!1),window.applyAudioStates()})),v.addEventListener("click",(()=>{"function"==typeof window.openUserSettings&&window.openUserSettings()})),C.addEventListener("click",(()=>{Z(),ge()})),I.addEventListener("input",(e=>{(0,z.rW)(I,L,C),function(e){Q=e;const t=function(e){const t=window.getSelection();if(!t||!t.rangeCount)return 0;const n=t.getRangeAt(0).cloneRange();return n.selectNodeContents(e),n.setEnd(t.focusNode,t.focusOffset),n.toString().length}(e),n=void 0!==e.value?e.value:e.innerText,a=n.lastIndexOf("@",t-1);if(-1===a)return void Z();const o=n.slice(a+1,t);if(/\s/.test(o))return void Z();const i=K.filter((e=>e.username.toLowerCase().startsWith(o.toLowerCase())));if(!i.length)return void Z();const r=(J||(J=document.createElement("div"),J.className="mention-dropdown",J.style.display="none",document.body.appendChild(J)),J);r.innerHTML="",i.forEach(((e,t)=>{const n=document.createElement("div");n.className="mention-dropdown-item",n.dataset.username=e.username;const a=document.createElement("img");a.src=e.avatar||"/images/default-avatar.png",a.width=24,a.height=24,a.style.borderRadius="45%";const o=document.createElement("span");o.textContent=e.username,n.appendChild(a),n.appendChild(o),n.addEventListener("mousedown",(t=>{t.preventDefault(),te(e.username)})),r.appendChild(n)})),X=0,ee();const d=e.getBoundingClientRect();r.style.width=d.width+"px";const s=document.getElementById("selectedChannelBar"),l=s?s.getBoundingClientRect().bottom:0,c=parseFloat(getComputedStyle(document.documentElement).fontSize),u=d.top-l-c;r.style.maxHeight=u+"px",r.style.left=d.left+"px",r.style.display="block";const m=Math.min(r.scrollHeight,u);r.style.top=d.top-m-c+"px"}(e.target)})),I.addEventListener("keydown",(e=>{(function(e){if(!J||"none"===J.style.display)return!1;if("ArrowDown"===e.key){e.preventDefault();const t=J.children.length;return X=Math.min(X+1,t-1),ee(),!0}if("ArrowUp"===e.key)return e.preventDefault(),X=Math.max(X-1,0),ee(),!0;if("Enter"===e.key){e.preventDefault();const t=J.children[X];return t&&te(t.dataset.username),!0}return"Escape"===e.key&&(Z(),!0)})(e)||"Enter"===e.key&&(e.preventDefault(),ge())}));const he=document.querySelector("#previewWrapper .caption-input");he&&(he.addEventListener("input",(()=>{""!==he.value.trim()||F().length>0?(C.style.display="block",L&&(L.style.display="none")):(C.style.display="none",L&&(L.style.display="block"))})),he.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),ge())}))),S&&S.addEventListener("click",(async()=>{if(window.screenShareProducerVideo){await l(e),S.classList.remove("active");const t=S.querySelector(".material-icons");if(t&&(t.textContent="desktop_windows"),b&&b.classList.remove("active"),b){const e=b.querySelector(".material-icons, .material-icons-outlined");e&&(e.textContent="desktop_windows",e.classList.add("material-icons"),e.classList.remove("material-icons-outlined"))}}else try{if(!E)return void alert("Ekran paylaşımı için transport henüz hazır değil.");window.clearScreenShareUI(),await s(E,e),S.classList.add("active");const t=S.querySelector(".material-icons");if(t&&(t.textContent="desktop_access_disabled"),b&&b.classList.add("active"),b){const e=b.querySelector(".material-icons, .material-icons-outlined");e&&(e.textContent="desktop_access_disabled",e.classList.remove("material-icons"),e.classList.add("material-icons-outlined"))}}catch(e){console.error("Ekran paylaşımı başlatılırken hata:",e)}})),b&&b.addEventListener("click",(async()=>{if(window.screenShareProducerVideo){await l(e),b.classList.remove("active");const t=b.querySelector(".material-icons, .material-icons-outlined");if(t&&(t.textContent="desktop_windows",t.classList.add("material-icons"),t.classList.remove("material-icons-outlined")),S&&S.classList.remove("active"),S){const e=S.querySelector(".material-icons");e&&(e.textContent="desktop_windows")}}else try{if(!E)return void alert("Ekran paylaşımı için transport henüz hazır değil.");window.clearScreenShareUI(),await s(E,e),b.classList.add("active");const t=b.querySelector(".material-icons, .material-icons-outlined");if(t&&(t.textContent="desktop_access_disabled",t.classList.remove("material-icons"),t.classList.add("material-icons-outlined")),S&&S.classList.add("active"),S){const e=S.querySelector(".material-icons");e&&(e.textContent="desktop_access_disabled")}}catch(e){console.error("Ekran paylaşımı başlatılırken hata:",e)}})),x&&x.addEventListener("contextmenu",window.showVideoContextMenu)}var ae=o(427);function oe(e,t){const n=document.createElement("div");n.classList.add("user-item");const a=document.createElement("img");a.classList.add("user-profile-pic"),a.dataset.username=e,a.src="/images/default-avatar.png",window.loadAvatar(e).then((e=>{a.src=e})),a.alt="";const o=document.createElement("span");function i(t){t.stopPropagation(),(0,ae.Ij)(e,t)}return o.classList.add("user-name"),o.textContent=e,n.appendChild(a),n.appendChild(o),a.addEventListener("click",i),o.addEventListener("click",i),n}function ie(e){e.on("avatarUpdated",(({username:e,avatar:t})=>{window.userAvatars[e]=t,document.querySelectorAll(`[data-username="${e}"]`).forEach((e=>{e.src=t||"/images/default-avatar.png"}))}))}window.latestChannelsData=null,window.unreadCounter={},window.channelUnreadCounts={},window.groupMuteUntil={},window.channelMuteUntil={},window.categoryMuteUntil={},window.mentionUnread={},window.channelUserRows={};const re="collapsedCategories";let de={};try{de=JSON.parse(localStorage.getItem(re))||{}}catch(e){de={}}let se={};function le(){try{localStorage.setItem(re,JSON.stringify(de))}catch(e){}}function ce(e){e&&e.dispatchEvent(new MouseEvent("click",{bubbles:!0}))}let ue=null;function me(){ue&&(ue.remove(),ue=null)}let pe=null,we=null,ye=null,ge=null,he=null;function fe(e,t){pe&&(pe.style.left=`${e+10}px`,pe.style.top=`${t+10}px`)}function ve(){pe&&(pe.remove(),pe=null)}function Ee(e,t,n){e.setAttribute("draggable","true"),e.addEventListener("dragstart",(e=>{e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t),function(e){ue=document.createElement("div"),ue.classList.add("drag-preview");const t=document.createElement("div");t.classList.add("drag-preview-avatar"),t.dataset.username=e,t.style.backgroundImage="url(/images/default-avatar.png)",window.loadAvatar(e).then((e=>{t.style.backgroundImage=`url(${e})`}));const n=document.createElement("span");n.textContent=e,ue.appendChild(t),ue.appendChild(n),document.body.appendChild(ue)}(n)})),e.addEventListener("dragend",(e=>{e.stopPropagation(),me()}))}function Ce(e,t,n=t){t.addEventListener("dragover",(e=>{if(!ye)return;e.preventDefault();const t=e.target.closest(".channel-item");if(!t||t===ye){const t=e.target.closest(".category-row");if(t){const n=t.getBoundingClientRect(),a=e.clientY-n.top>n.height/2;t.parentNode.insertBefore(we,a?t.nextSibling:t)}else{const t=e.currentTarget;we.parentNode!==t&&t.appendChild(we)}return void fe(e.clientX,e.clientY)}const n=t.getBoundingClientRect(),a=e.clientY-n.top>n.height/2;t.parentNode.insertBefore(we,a?t.nextSibling:t),fe(e.clientX,e.clientY)})),t.addEventListener("drop",(t=>{if(!ye||!we)return;t.preventDefault(),we.parentNode.insertBefore(ye,we);const a=Array.from(n.querySelectorAll(".category-row, .channel-item")).indexOf(ye);ve(),we.remove(),we=null,ye.classList.remove("dragging");const o=ye.parentNode.closest(".category-row"),i=o?o.dataset.categoryId:null;e.emit("assignChannelCategory",{groupId:window.selectedGroup,channelId:ye.dataset.roomId,categoryId:i}),e.emit("reorderChannel",{groupId:window.selectedGroup,channelId:ye.dataset.roomId,newIndex:a}),ye.classList.add("snap");const r=ye;setTimeout((()=>r.classList.remove("snap")),150),ye=null}))}function Le(e){const{loginScreen:t,callScreen:n,loginErrorMessage:a,loginUsernameInput:o,loginPasswordInput:i,registerScreen:r,registerErrorMessage:s,groupListDiv:l,groupTitle:c,deleteGroupBtn:u,renameGroupBtn:m,groupSettingsBtn:p,leaveGroupBtn:w,roomListDiv:y,selectedChannelTitle:g,textChannelContainer:h}=window;function f(t){function n(t,n){const a=t.querySelector(".channel-user-left"),o=t.querySelector(".channel-user-right");a.dataset.userId=n.id,a.dataset.username=n.username;let i=a.querySelector(".channel-user-avatar");i||(i=document.createElement("div"),i.classList.add("channel-user-avatar"),a.prepend(i)),i.id=`avatar-${n.id}`,i.dataset.username=n.username,i.style.backgroundImage="url(/images/default-avatar.png)",window.loadAvatar(n.username).then((e=>{i.style.backgroundImage=`url(${e})`}));let r=a.querySelector("span.user-name");r||(r=document.createElement("span"),r.classList.add("user-name"),a.appendChild(r)),r.textContent=n.username||"(İsimsiz)";const d=a.querySelector(".visibility-icon");if(e.id&&Array.isArray(window.screenShareWatchers)&&window.screenShareWatchers.includes(n.username)){if(!d){const e=document.createElement("span");e.classList.add("material-icons","visibility-icon"),e.textContent="visibility",a.appendChild(e)}}else d&&d.remove();if(o.innerHTML="",!1===n.hasMic){const e=document.createElement("span");e.classList.add("material-icons","mic-missing"),e.textContent="mic_off",o.appendChild(e)}else if(!1===n.micEnabled){const e=document.createElement("span");e.classList.add("material-icons"),e.textContent="mic_off",o.appendChild(e)}if(!0===n.selfDeafened){const e=document.createElement("span");e.classList.add("material-icons"),e.textContent="headset_off",o.appendChild(e)}if(!0===n.isScreenSharing){const t=document.createElement("span");t.classList.add("screen-share-indicator"),t.textContent="YAYINDA",n.screenShareProducerId&&(t.style.cursor="pointer",t.addEventListener("click",(()=>{window.clearScreenShareUI(),$(e,window.currentGroup,window.currentRoom,n.screenShareProducerId,window.clearScreenShareUI)}))),o.appendChild(t)}}t&&(window.channelUserRows=window.channelUserRows||{},Object.keys(t).forEach((e=>{const a=t[e],o=document.getElementById(`channel-users-${e}`);if(!o)return;const i=window.channelUserRows[e]||{};window.channelUserRows[e]=i;const r=new Set;a.users.forEach((e=>{let t=i[e.id];t?n(t,e):(t=function(e){const t=document.createElement("div");t.classList.add("channel-user");const a=document.createElement("div");a.classList.add("channel-user-left"),t.appendChild(a);const o=document.createElement("div");return o.classList.add("channel-user-right"),t.appendChild(o),Ee(a,e.id,e.username),n(t,e),t}(e),i[e.id]=t),r.add(String(e.id)),o.appendChild(t)})),Object.keys(i).forEach((e=>{if(!r.has(String(e))){const t=i[e];t&&t.parentNode&&t.parentNode.removeChild(t),delete i[e]}}))})))}function v(t,n=!1){const a=document.createElement("div");a.classList.add("user-card"),a.dataset.userId=t.id,a.dataset.username=t.username,n&&a.classList.add("broadcast-card");const o=document.createElement("div");o.classList.add("user-card-info"),a.appendChild(o),!0===t.isScreenSharing&&a.classList.add("stream-available");const i=document.createElement("img");i.classList.add("user-avatar"),i.dataset.username=t.username,i.src="/images/default-avatar.png",i.alt="",window.loadAvatar(t.username).then((e=>{i.src=e}));const r=document.createElement("span");if(r.classList.add("user-name"),r.textContent=t.username||"(İsimsiz)",o.appendChild(i),o.appendChild(r),!1===t.hasMic){const e=document.createElement("span");e.classList.add("material-icons","mic-missing"),e.textContent="mic_off",o.appendChild(e)}else if(!1===t.micEnabled){const e=document.createElement("span");e.classList.add("material-icons"),e.textContent="mic_off",o.appendChild(e)}if(!0===t.selfDeafened){const e=document.createElement("span");e.classList.add("material-icons"),e.textContent="headset_off",o.appendChild(e)}if(!0===t.isScreenSharing){const n=document.createElement("span");if(n.classList.add("screen-share-indicator"),n.textContent="YAYINDA",a.appendChild(n),t.screenShareProducerId&&(!window.screenShareVideo||window.broadcastingUserId!==t.id)){const n=document.createElement("button");n.classList.add("watch-stream-btn","btn","primary"),n.textContent="Watch Stream",n.addEventListener("click",(()=>{window.clearScreenShareUI(),$(e,window.currentGroup,window.currentRoom,t.screenShareProducerId,window.clearScreenShareUI)})),a.appendChild(n)}}return Ee(a,t.id,t.username),a}function E(e){const t=document.getElementById("channelUsersContainer");if(!t)return;if(t.innerHTML="",!Array.isArray(e))return;if(window.screenShareVideo&&window.broadcastingUserId)return void function(e,t){const n=document.getElementById("channelUsersContainer");if(!n)return;n.innerHTML="",n.classList.add("broadcast-mode"),n.style.display="flex",n.style.flexDirection="column",n.style.justifyContent="space-between",n.style.gridTemplateColumns="",n.style.gridAutoRows="";const a=e.find((e=>e.id===t)),o=e.filter((e=>e.id!==t));if(a){const e=v(a,!0);n.appendChild(e),window.screenShareContainer&&window.broadcastingUserId===t&&e.appendChild(window.screenShareContainer)}const i=document.createElement("div");i.classList.add("viewer-row"),o.forEach((e=>{i.appendChild(v(e))})),n.appendChild(i)}(e,window.broadcastingUserId);t.classList.remove("broadcast-mode");const n=e.length||0;if(0===n)return;const a=window.getComputedStyle(t),o=parseFloat(a.gap)||0,i=(parseFloat(a.paddingLeft)||0)+(parseFloat(a.paddingRight)||0),r=(parseFloat(a.paddingTop)||0)+(parseFloat(a.paddingBottom)||0),d=t.clientWidth-i,s=t.clientHeight-r;function l(e,t){if(3===e)return{rows:[2,1],columns:2};let n=Math.min(4,Math.max(1,t)),a=Math.ceil(e/n);e%n==1&&a>1&&n<4&&(n+=1,a=Math.ceil(e/n));const o=Math.floor(e/a);let i=e-o*a;const r=new Array(a).fill(o);for(let e=0;e<i;e++)r[e]+=1;return{rows:r,columns:Math.max(...r)}}let c=Math.ceil(Math.sqrt(n)),u=l(n,c),m=(d-o*(u.columns-1))/u.columns,p=9*m/16;for(;p*u.rows.length+o*(u.rows.length-1)>s&&c<n;)c+=1,u=l(n,c),m=(d-o*(u.columns-1))/u.columns,p=9*m/16;const{rows:w,columns:y}=u;t.style.gridTemplateColumns=`repeat(${y}, ${m}px)`,t.style.gridAutoRows=`${p}px`,t.style.justifyContent="center";let g=0;w.forEach(((a,o)=>{const i=Math.floor((y-a)/2);for(let r=0;r<a;r++){const d=v(e[g++]);d.style.gridRow=o+1,1===a?n>1?(d.style.gridColumn=`1 / span ${y}`,d.style.width=`${m}px`,d.style.justifySelf="center"):d.style.gridColumn="1":d.style.gridColumn=i+r+1,t.appendChild(d)}}))}document.addEventListener("dragover",(e=>{var t,n;t=e.clientX,n=e.clientY,ue&&(ue.style.left=`${t+10}px`,ue.style.top=`${n+10}px`),fe(e.clientX,e.clientY)})),y?(Ce(e,y),y.addEventListener("dragover",(e=>{if(!he)return;e.preventDefault();const t=y.getBoundingClientRect();if(e.clientY>=t.bottom-5)return void y.appendChild(ge);const n=e.target.closest(".category-row, .channel-item");if(n){if(n===he)return;const t=n.getBoundingClientRect(),a=e.clientY>t.top+t.height/2;n.parentNode.insertBefore(ge,a?n.nextSibling:n)}else{const n=e.clientY-t.top>t.height/2;y.insertBefore(ge,n?null:y.firstElementChild)}})),y.addEventListener("drop",(t=>{if(!he||!ge)return;t.preventDefault(),ge.parentNode.insertBefore(he,ge);const n=Array.from(y.querySelectorAll(".category-row, .channel-item")).indexOf(he);ge.remove(),ge=null,he.classList.remove("dragging"),e.emit("reorderCategory",{groupId:window.selectedGroup,categoryId:he.dataset.categoryId,newIndex:n}),he.classList.add("snap");const a=he;setTimeout((()=>a.classList.remove("snap")),150),he=null}))):d.warn("roomListDiv element not found, skipping drag and drop setup"),ie&&ie(e),setInterval((()=>{Object.entries(window.groupMuteUntil||{}).forEach((([t,n])=>{if(n!==1/0&&n&&Date.now()>n){delete window.groupMuteUntil[t],e.emit("muteGroup",{groupId:t,duration:0});const n=l.querySelector(`.grp-item[data-group-id="${t}"]`);n&&n.classList.remove("muted","channel-muted"),t===window.selectedGroup&&y&&y.querySelectorAll(".channel-item").forEach((e=>{e.classList.remove("muted","channel-muted");const n=e.dataset.roomId,a=window.channelMuteUntil[t]&&window.channelMuteUntil[t][n];a&&Date.now()<a&&e.classList.add("muted","channel-muted")}))}})),Object.entries(window.channelMuteUntil||{}).forEach((([t,n])=>{n&&Object.entries(n).forEach((([n,a])=>{if(a!==1/0&&a&&Date.now()>a&&(delete window.channelMuteUntil[t][n],e.emit("muteChannel",{groupId:t,channelId:n,duration:0}),t===window.selectedGroup&&y)){const e=y.querySelector(`.channel-item[data-room-id="${n}"]`);e&&e.classList.remove("muted","channel-muted")}}))}))}),6e4),window.renderVoiceChannelGrid=E;const S=document.getElementById("channelContentArea"),b=()=>{"voice"===window.currentRoomType&&window.latestChannelsData&&window.currentRoom&&window.latestChannelsData[window.currentRoom]&&E(window.latestChannelsData[window.currentRoom].users)};S&&("ResizeObserver"in window?(window.channelAreaResizeObserver&&window.channelAreaResizeObserver.disconnect(),window.channelAreaResizeObserver=new ResizeObserver(b),window.channelAreaResizeObserver.observe(S)):(window.channelAreaResizeHandler&&window.removeEventListener("resize",window.channelAreaResizeHandler),window.channelAreaResizeHandler=b,window.addEventListener("resize",window.channelAreaResizeHandler))),e.on("connect",(()=>{d.info("Socket connected => "+e.id)})),e.on("disconnect",(()=>{d.warn("Socket disconnect")})),e.on("loginResult",(r=>{if(r.success){window.username=r.username;try{localStorage.setItem("username",r.username),r.token&&localStorage.setItem("token",r.token)}catch(e){}r.token&&(e.auth=e.auth||{},e.auth.token=r.token),e.emit("set-username",window.username),t.style.display="none",n.style.display="flex",document.getElementById("userCardName").textContent=window.username,window.applyAudioStates(),window.loadAvatar(window.username).then((e=>{const t=document.getElementById("userCardAvatar");t&&(t.style.backgroundImage=`url(${e})`,t.dataset.username=window.username)}))}else a.textContent="Lütfen girdiğiniz bilgileri kontrol edip tekrar deneyin",a.style.display="block",o.classList.add("shake"),i.classList.add("shake")})),e.on("registerResult",(e=>{e.success?(alert("Hesap başarıyla oluşturuldu"),r.style.display="none",t.style.display="block"):(s.textContent=e.message||"Kayıt hatası",s.style.display="block")})),e.on("errorMessage",(e=>{"function"==typeof showToast?showToast(e):alert(e)})),e.on("groupUsers",(e=>{!function(e){const t=document.getElementById("userList");if(!t)return;t.innerHTML="";const n=document.createElement("div");if(n.textContent="Çevrimiçi",n.style.fontWeight="normal",n.style.fontSize="0.85rem",t.appendChild(n),e.online&&e.online.length>0)e.online.forEach((e=>{t.appendChild(oe(e.username))}));else{const e=document.createElement("p");e.textContent="(Kimse yok)",e.style.fontSize="0.75rem",t.appendChild(e)}const a=document.createElement("div");if(a.textContent="Çevrimdışı",a.style.fontWeight="normal",a.style.fontSize="0.85rem",a.style.marginTop="1rem",t.appendChild(a),e.offline&&e.offline.length>0)e.offline.forEach((e=>{t.appendChild(oe(e.username))}));else{const e=document.createElement("p");e.textContent="(Kimse yok)",e.style.fontSize="0.75rem",t.appendChild(e)}}(e)})),e.on("groupsList",(t=>{l.innerHTML="",t.forEach((t=>{const n=document.createElement("div");n.className="grp-item",n.setAttribute("data-group-id",t.id),n.innerText=t.name[0].toUpperCase(),n.title=t.name+" ("+t.id+")";let a=(t.unreadCount??t.unread??0)||window.unreadCounter&&window.unreadCounter[t.id]||0;const o=window.groupMuteUntil[t.id];o&&Date.now()<o&&(a=0);const i=window.mentionUnread[t.id]&&Object.keys(window.mentionUnread[t.id]).length>0;if(a>=1||i){const e=document.createElement("span");e.className="unread-dot",i&&e.classList.add("mention-dot"),n.appendChild(e),n.classList.add("unread")}t.id===window.selectedGroup&&n.classList.add("selected"),n.addEventListener("contextmenu",(e=>{e.preventDefault(),window.showGroupContextMenu(e,t)})),n.addEventListener("click",(()=>{document.querySelectorAll(".grp-item").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),window.selectedGroup=t.id;try{localStorage.setItem("lastGroupId",t.id)}catch(e){console.warn("Unable to persist lastGroupId",e)}c.textContent=t.name,e.emit("joinGroup",t.id),"function"==typeof window.removeScreenShareEndedMessage&&window.removeScreenShareEndedMessage(),t.owner===window.username?(u.style.display="block",m.style.display="block"):(u.style.display="none",m.style.display="none"),p&&(p.style.display=t.owner===window.username?"block":"none"),w&&(w.style.display=t.owner===window.username?"none":"block")})),l.appendChild(n)}));const n=(()=>{try{return localStorage.getItem("lastGroupId")}catch(e){return null}})();if(n?ce(l.querySelector(`.grp-item[data-group-id="${n}"]`)):t.length>0&&ce(l.querySelector(`.grp-item[data-group-id="${t[0].id}"]`)),window.selectedGroup&&!t.some((e=>e.id===window.selectedGroup))){window.selectedGroup=null,window.currentGroup=null,window.currentRoom=null,window.currentTextChannel=null,window.currentRoomType=null,c.textContent="Seçili Grup",g.textContent="Kanal Seçilmedi",y.innerHTML="","function"==typeof window.hideVoiceSections&&window.hideVoiceSections(),h&&(h.style.display="none");const e=document.getElementById("channelUsersContainer");e&&(e.innerHTML="")}})),e.on("groupDeleted",(({groupId:e})=>{document.querySelectorAll(".grp-item").forEach((t=>{t.getAttribute("data-group-id")===e&&t.remove()})),window.selectedGroup===e&&(window.selectedGroup=null,c.textContent="Seçili Grup")})),e.on("groupUnreadReset",(({groupId:e})=>{const t=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(t){const e=t.querySelector(".unread-dot");e&&e.remove(),t.classList.remove("unread")}window.unreadCounter[e]&&(window.unreadCounter[e]=0),window.mentionUnread[e]&&delete window.mentionUnread[e],e===window.selectedGroup&&y.querySelectorAll(".channel-item").forEach((e=>{const t=e.querySelector(".unread-dot");t&&t.remove(),e.classList.remove("unread")}))})),e.on("channelUnread",(({groupId:e,channelId:t})=>{const n=window.groupMuteUntil[e];if(n&&Date.now()<n)return;const a=window.channelMuteUntil[e]&&window.channelMuteUntil[e][t],o=y.querySelector(`.channel-item[data-room-id="${t}"]`)?.parentNode.closest(".category-row")?.dataset.categoryId,i=o&&window.categoryMuteUntil[e]&&window.categoryMuteUntil[e][o];if(!(a&&Date.now()<a||i&&Date.now()<i)&&(window.channelUnreadCounts[e]||(window.channelUnreadCounts[e]={}),window.channelUnreadCounts[e][t]=(window.channelUnreadCounts[e][t]||0)+1,e!==window.selectedGroup||t!==window.currentTextChannel)){window.unreadCounter[e]=(window.unreadCounter[e]||0)+1;const n=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(n&&!n.querySelector(".unread-dot")){const e=document.createElement("span");e.className="unread-dot",n.appendChild(e)}if(n&&n.classList.add("unread"),e===window.selectedGroup){const e=y.querySelector(`.channel-item[data-room-id="${t}"]`);if(e&&!e.querySelector(".unread-dot")){const t=document.createElement("span");t.className="unread-dot",e.appendChild(t)}e&&e.classList.add("unread")}}})),e.on("mentionUnread",(({groupId:e,channelId:t})=>{window.mentionUnread[e]||(window.mentionUnread[e]={}),window.mentionUnread[e][t]=!0;const n=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(n){let e=n.querySelector(".unread-dot");e||(e=document.createElement("span"),e.className="unread-dot",n.appendChild(e)),e.classList.add("mention-dot"),n.classList.add("unread")}if(e===window.selectedGroup){const e=y.querySelector(`.channel-item[data-room-id="${t}"]`);if(e){let t=e.querySelector(".unread-dot");t||(t=document.createElement("span"),t.className="unread-dot",e.appendChild(t)),t.classList.add("mention-dot"),e.classList.add("unread")}}})),e.on("channelRead",(({groupId:e,channelId:t})=>{window.unreadCounter[e]&&(window.unreadCounter[e]=Math.max(0,window.unreadCounter[e]-1)),window.channelUnreadCounts[e]&&(window.channelUnreadCounts[e][t]=0),window.mentionUnread[e]&&(delete window.mentionUnread[e][t],0===Object.keys(window.mentionUnread[e]).length&&delete window.mentionUnread[e]);const n=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(n)if(0===window.unreadCounter[e]){const e=n.querySelector(".unread-dot");e&&e.remove(),n.classList.remove("unread")}else{const t=n.querySelector(".unread-dot");!t||window.mentionUnread[e]&&0!==Object.keys(window.mentionUnread[e]).length||t.classList.remove("mention-dot")}if(e===window.selectedGroup){const e=y.querySelector(`.channel-item[data-room-id="${t}"]`);if(e){const t=e.querySelector(".unread-dot");t&&(t.classList.remove("mention-dot"),t.remove()),e.classList.remove("unread")}}})),e.on("mentionCounts",(e=>{window.mentionUnread={},Object.entries(e||{}).forEach((([e,t])=>{Object.entries(t).forEach((([t,n])=>{Number(n)>0&&(window.mentionUnread[e]||(window.mentionUnread[e]={}),window.mentionUnread[e][t]=!0)}))}))})),e.on("unreadCounts",(e=>{window.unreadCounter=window.unreadCounter||{},window.channelUnreadCounts=e||{},Object.entries(e||{}).forEach((([e,t])=>{const n=Object.values(t).reduce(((e,t)=>e+(Number(t)||0)),0),a=window.groupMuteUntil[e],o=a&&Date.now()<a,i=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(n>0&&!o){window.unreadCounter[e]=n;let t=i&&i.querySelector(".unread-dot");i&&!t&&(t=document.createElement("span"),t.className="unread-dot",i.appendChild(t)),t&&window.mentionUnread[e]&&Object.keys(window.mentionUnread[e]).length>0&&t.classList.add("mention-dot"),i&&i.classList.add("unread")}else if(i){const e=i.querySelector(".unread-dot");e&&e.remove(),i.classList.remove("unread")}e===window.selectedGroup&&Object.entries(t).forEach((([t,n])=>{const a=y.querySelector(`.channel-item[data-room-id="${t}"]`);if(!a)return;const i=window.channelMuteUntil[e]&&window.channelMuteUntil[e][t],r=o||i&&Date.now()<i;let d=a.querySelector(".unread-dot");n>0&&!r&&!d?(d=document.createElement("span"),d.className="unread-dot",a.appendChild(d)):(0===n||r)&&d&&d.remove(),n>0&&!r&&d&&window.mentionUnread[e]&&window.mentionUnread[e][t]&&d.classList.add("mention-dot"),n>0&&!r?a.classList.add("unread"):a.classList.remove("unread")}))}))}));const k=864e13;function M(e){const t=e.querySelector(".category-channels"),n=e.querySelector(".collapse-icon"),a=e.dataset.categoryId,o=de[a],i=t&&t.children.length>0;t&&(t.style.display=!o&&i?"flex":"none"),n&&(n.textContent=o?"chevron_right":"expand_more"),e.classList.toggle("expanded",!o&&i)}function T(e,t){let n=e.firstChild,a=document.createDocumentFragment();for(t.forEach((t=>{t===n?(a.firstChild&&(e.insertBefore(a,n),a=document.createDocumentFragment()),n=n.nextSibling):a.appendChild(t)})),a.firstChild&&e.insertBefore(a,n);n;){const e=n.nextSibling;n.remove(),n=e}}e.on("activeMutes",(e=>{window.groupMuteUntil=window.groupMuteUntil||{},window.channelMuteUntil=window.channelMuteUntil||{},window.categoryMuteUntil=window.categoryMuteUntil||{},Object.entries(e||{}).forEach((([e,t])=>{if(t.muteUntil){const n=new Date(t.muteUntil).getTime();window.groupMuteUntil[e]=n>=k?1/0:n;const a=l.querySelector(`.grp-item[data-group-id="${e}"]`);a&&a.classList.add("muted"),e===window.selectedGroup&&y.querySelectorAll(".channel-item").forEach((e=>e.classList.add("muted","channel-muted")))}t.channelMuteUntil&&(window.channelMuteUntil[e]||(window.channelMuteUntil[e]={}),Object.entries(t.channelMuteUntil).forEach((([t,n])=>{const a=new Date(n).getTime();if(window.channelMuteUntil[e][t]=a>=k?1/0:a,e===window.selectedGroup){const e=y.querySelector(`.channel-item[data-room-id="${t}"]`);e&&e.classList.add("muted","channel-muted")}}))),t.categoryMuteUntil&&(window.categoryMuteUntil[e]||(window.categoryMuteUntil[e]={}),Object.entries(t.categoryMuteUntil).forEach((([t,n])=>{const a=new Date(n).getTime();if(window.categoryMuteUntil[e][t]=a>=k?1/0:a,e===window.selectedGroup){const e=y.querySelector(`.category-row[data-category-id="${t}"]`);e&&e.classList.add("muted")}})))}))})),e.on("activeNotifyTypes",(e=>{window.groupNotifyType={},window.channelNotifyType={},Object.entries(e||{}).forEach((([e,t])=>{t.notificationType&&(window.groupNotifyType[e]=t.notificationType),t.channelNotificationType&&(window.channelNotifyType[e]=t.channelNotificationType)}))})),e.on("activeCategoryPrefs",(e=>{se=e.order||{},Object.entries(e.collapsed||{}).forEach((([e,t])=>{Object.entries(t).forEach((([e,t])=>{de[e]=!!t}))})),le()})),e.on("groupNotifyTypeUpdated",(({groupId:e,type:t})=>{e&&(window.groupNotifyType[e]=t,window.openNotifyTarget&&"group"===window.openNotifyType&&window.openNotifyTarget.dataset.groupId===e&&window.showNotificationSubMenu(window.openNotifyTarget,"group"))})),e.on("channelNotifyTypeUpdated",(({groupId:e,channelId:t,type:n})=>{e&&t&&(window.channelNotifyType[e]=window.channelNotifyType[e]||{},window.channelNotifyType[e][t]=n,window.openNotifyTarget&&"channel"===window.openNotifyType&&window.openNotifyTarget.dataset.channelId===t&&window.openNotifyTarget.dataset.groupId===e&&window.showNotificationSubMenu(window.openNotifyTarget,"channel"))})),e.on("groupMuted",(({groupId:e,muteUntil:t})=>{if(!e)return;if(t){const n=new Date(t).getTime();window.groupMuteUntil[e]=n>=k?1/0:n}else window.groupMuteUntil[e]=0;const n=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(n){const e=n.querySelector(".unread-dot");e&&e.remove(),n.classList.remove("unread"),n.classList.add("muted")}window.unreadCounter[e]=0,e===window.selectedGroup&&(y.querySelectorAll(".channel-item").forEach((e=>{const t=e.querySelector(".unread-dot");t&&t.remove(),e.classList.remove("unread")})),window.channelUnreadCounts[e]&&Object.keys(window.channelUnreadCounts[e]).forEach((t=>{window.channelUnreadCounts[e][t]=0})))})),e.on("channelMuted",(({groupId:e,channelId:t,muteUntil:n})=>{if(e&&t){if(window.channelMuteUntil[e]||(window.channelMuteUntil[e]={}),n){const a=new Date(n).getTime();window.channelMuteUntil[e][t]=a>=k?1/0:a}else window.channelMuteUntil[e][t]=0;if(window.channelUnreadCounts[e]&&(window.channelUnreadCounts[e][t]=0),e===window.selectedGroup){const n=y.querySelector(`.channel-item[data-room-id="${t}"]`);if(n){const e=n.querySelector(".unread-dot");e&&e.remove(),n.classList.remove("unread"),n.classList.add("muted","channel-muted")}if(0===Object.values(window.channelUnreadCounts[e]||{}).reduce(((e,t)=>e+(Number(t)||0)),0)){const t=l.querySelector(`.grp-item[data-group-id="${e}"]`);if(t){const e=t.querySelector(".unread-dot");e&&e.remove(),t.classList.remove("unread"),t.classList.add("muted")}window.unreadCounter[e]=0}}}})),e.on("categoryMuted",(({groupId:e,categoryId:t,muteUntil:n})=>{if(e&&t){if(window.categoryMuteUntil[e]||(window.categoryMuteUntil[e]={}),n){const a=new Date(n).getTime();window.categoryMuteUntil[e][t]=a>=k?1/0:a}else window.categoryMuteUntil[e][t]=0;if(e===window.selectedGroup){const e=y.querySelector(`.category-row[data-category-id="${t}"]`);e&&e.classList.add("muted")}}})),e.on("muteCleared",(({groupId:e,channelId:t,categoryId:n})=>{if(t){window.channelMuteUntil[e]&&delete window.channelMuteUntil[e][t];const n=y.querySelector(`.channel-item[data-room-id="${t}"]`);n&&n.classList.remove("muted","channel-muted")}else if(n){window.categoryMuteUntil[e]&&delete window.categoryMuteUntil[e][n];const t=y.querySelector(`.category-row[data-category-id="${n}"]`);t&&t.classList.remove("muted")}else if(e){delete window.groupMuteUntil[e];const t=l.querySelector(`.grp-item[data-group-id="${e}"]`);t&&t.classList.remove("muted"),e===window.selectedGroup&&y.querySelectorAll(".channel-item").forEach((t=>{t.classList.remove("muted","channel-muted");const n=t.dataset.roomId,a=window.channelMuteUntil[e]&&window.channelMuteUntil[e][n];a&&Date.now()<a&&t.classList.add("muted","channel-muted")}))}})),e.on("categoryCollapseUpdated",(({groupId:e,categoryId:t,collapsed:n})=>{if(de[t]=n,le(),e===window.selectedGroup){const e=y.querySelector(`.category-row[data-category-id="${t}"]`);e&&M(e)}})),e.on("categoryOrderUpdated",(({groupId:e,order:t})=>{if(se[e]=t||{},e===window.selectedGroup){const e=Array.from(y.querySelectorAll(".category-row"));e.sort(((e,n)=>(t[e.dataset.categoryId]??0)-(t[n.dataset.categoryId]??0))),e.forEach((e=>y.appendChild(e)))}})),e.on("channelRenamed",(({channelId:e,newName:t})=>{const n=y.querySelector(`.channel-item[data-room-id="${e}"]`);if(n){const e=n.querySelector(".channel-header .channel-name");e&&(e.textContent=t)}})),e.on("channelDeleted",(({channelId:e})=>{const t=y.querySelector(`.channel-item[data-room-id="${e}"]`);t&&t.remove()})),e.on("roomsList",((t=[])=>{const n=window.currentTextChannel;window.channelUnreadCounts[window.selectedGroup]={};const a={};y.querySelectorAll(".category-row").forEach((e=>{a[e.dataset.categoryId]=e}));const o={};y.querySelectorAll(".channel-item").forEach((e=>{o[e.dataset.roomId]=e}));const i=[],r={},d={};t.forEach((t=>{if("category"===t.type){let n=a[t.id];n||(n=function(t){const n=document.createElement("div");n.className="category-row",n.dataset.categoryId=t.id;const a=document.createElement("div");a.className="category-header";const o=document.createElement("span");o.classList.add("material-icons","collapse-icon");const i=de[t.id];o.textContent=i?"chevron_right":"expand_more",n.classList.toggle("expanded",!i);const r=window.categoryMuteUntil[window.selectedGroup]&&window.categoryMuteUntil[window.selectedGroup][t.id],d=r&&Date.now()<r,s=document.createElement("span");s.className="category-name",s.textContent=t.name;const l=document.createElement("span");l.classList.add("material-icons","category-add-btn"),l.textContent="add",l.addEventListener("click",(e=>{e.stopPropagation(),window.createChannelTargetCategory=t.id,window.roomModal&&(window.roomModal.style.display="flex",window.roomModal.classList.add("active"))})),a.appendChild(s),a.appendChild(o),a.appendChild(l),d&&n.classList.add("muted"),n.appendChild(a);const c=document.createElement("div");var u;return c.className="category-channels",i&&(c.style.display="none"),n.appendChild(c),a.addEventListener("click",(()=>{de[t.id]=!de[t.id],le(),M(n),e.emit("setCategoryCollapsed",{groupId:window.selectedGroup,categoryId:t.id,collapsed:de[t.id]})})),a.addEventListener("contextmenu",(e=>{e.preventDefault(),window.showCategoryContextMenu(e,t)})),a.addEventListener("dragover",(a=>{ye&&(a.preventDefault(),"none"===c.style.display&&(c.style.display="flex",o.textContent="expand_more",n.classList.add("expanded"),de[t.id]=!1,le(),e.emit("setCategoryCollapsed",{groupId:window.selectedGroup,categoryId:t.id,collapsed:!1})),we&&we.parentNode!==c&&c.appendChild(we),fe(a.clientX,a.clientY))})),a.addEventListener("drop",(a=>{if(!ye||!we)return;a.preventDefault(),we.parentNode!==c&&c.appendChild(we),we.parentNode===c&&c.insertBefore(ye,we);const o=Array.from(y.querySelectorAll(".category-row, .channel-item")).indexOf(ye);ve(),we.remove(),we=null,ye.classList.remove("dragging"),e.emit("assignChannelCategory",{groupId:window.selectedGroup,channelId:ye.dataset.roomId,categoryId:t.id}),e.emit("reorderChannel",{groupId:window.selectedGroup,channelId:ye.dataset.roomId,newIndex:o}),ye.classList.add("snap");const i=ye;setTimeout((()=>i.classList.remove("snap")),150),ye=null,M(n)})),(u=n).setAttribute("draggable","true"),u.addEventListener("dragstart",(e=>{he=u,e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage(new Image,0,0),ge=document.createElement("div"),ge.classList.add("category-placeholder"),u.parentNode.insertBefore(ge,u.nextSibling),u.classList.add("dragging")})),u.addEventListener("dragend",(()=>{ge&&ge.remove(),ge=null,u.classList.remove("dragging"),he=null})),M(n),n}(t)),r[t.id]=n.querySelector(".category-channels"),i.push(n)}else{let n=o[t.id];n?function(e,t){e.classList.toggle("voice-channel-item","voice"===t.type),e.dataset.roomId=t.id;let n=t.unreadCount??t.unread??0;const a=window.groupMuteUntil[window.selectedGroup],o=a&&Date.now()<a,i=window.channelMuteUntil[window.selectedGroup]&&window.channelMuteUntil[window.selectedGroup][t.id],r=i&&Date.now()<i;o||r?(n=0,e.classList.add("muted","channel-muted")):e.classList.remove("muted","channel-muted");const d=e.querySelector(".channel-header .channel-name");if(d&&(d.textContent=t.name),window.channelUnreadCounts[window.selectedGroup]||(window.channelUnreadCounts[window.selectedGroup]={}),"text"===t.type){window.channelUnreadCounts[window.selectedGroup][t.id]=n;let a=e.querySelector(".unread-dot");const i=window.mentionUnread[window.selectedGroup]&&window.mentionUnread[window.selectedGroup][t.id];n>0&&!o&&!r?(a||(a=document.createElement("span"),a.className="unread-dot",e.appendChild(a)),a.classList.toggle("mention-dot",Boolean(i)),e.classList.add("unread")):(a&&a.remove(),e.classList.remove("unread"))}}(n,t):(n=function(t){const n=document.createElement("div");n.className="channel-item",n.dataset.roomId=t.id;let a=t.unreadCount??t.unread??0;const o=window.groupMuteUntil[window.selectedGroup],i=o&&Date.now()<o,r=window.channelMuteUntil[window.selectedGroup]&&window.channelMuteUntil[window.selectedGroup][t.id],d=r&&Date.now()<r;if((i||d)&&(a=0,n.classList.add("muted","channel-muted")),"text"===t.type&&a>0){const e=document.createElement("span");e.className="unread-dot",window.mentionUnread[window.selectedGroup]&&window.mentionUnread[window.selectedGroup][t.id]&&e.classList.add("mention-dot"),n.appendChild(e),n.classList.add("unread")}window.channelUnreadCounts[window.selectedGroup]||(window.channelUnreadCounts[window.selectedGroup]={}),"text"===t.type&&(window.channelUnreadCounts[window.selectedGroup][t.id]=a),"voice"===t.type&&(n.classList.add("voice-channel-item"),n.addEventListener("dragover",(e=>e.preventDefault())),n.addEventListener("drop",(n=>{n.preventDefault(),me();const a=n.dataTransfer.getData("text/plain");a&&e.emit("moveUser",{userId:a,groupId:window.selectedGroup,roomId:t.id})})));const s=document.createElement("div");let l;s.className="channel-header","voice"===t.type?(l=document.createElement("span"),l.classList.add("material-icons","channel-icon"),l.textContent="volume_up"):(l=document.createElement("span"),l.classList.add("material-icons","channel-icon"),l.textContent="chat");const u=document.createElement("span");u.classList.add("channel-name"),u.textContent=t.name,s.appendChild(l),s.appendChild(u);const m=document.createElement("span");m.classList.add("material-icons","channel-settings-btn"),m.textContent="settings",s.appendChild(m);const p=document.createElement("div");return p.className="channel-users",p.id=`channel-users-${t.id}`,n.appendChild(s),n.appendChild(p),n.addEventListener("contextmenu",(e=>{e.preventDefault(),window.showChannelContextMenu(e,t)})),n.addEventListener("click",(()=>{if("text"===t.type){g.textContent=t.name,h.style.display="flex",h.style.flexDirection="column";const a=document.getElementById("channelUsersContainer");a&&(a.style.display="none",a.innerHTML=""),window.currentRoom&&"voice"===window.currentRoomType||(window.hideVoiceSections(),window.currentRoomType="text"),window.textMessages.innerHTML="",window.currentTextChannel=t.id,window.textMessages.dataset.channelId=t.id,e.emit("joinTextChannel",{groupId:window.selectedGroup,roomId:t.id});try{localStorage.setItem(`lastTextChannel:${window.selectedGroup}`,t.id)}catch(e){console.warn("Unable to persist last text channel",e)}return"function"==typeof window.removeScreenShareEndedMessage&&window.removeScreenShareEndedMessage(),document.querySelectorAll(".channel-item").forEach((e=>e.classList.remove("connected"))),void n.classList.add("connected")}if(window.clearScreenShareUI(),document.getElementById("channelUsersContainer").style.display="grid",document.querySelectorAll(".channel-item").forEach((e=>e.classList.remove("connected"))),window.currentRoom===t.id&&window.currentGroup===window.selectedGroup)return n.classList.add("connected"),window.updateVoiceChannelUI(t.name,!0),void(window.latestChannelsData&&window.latestChannelsData[t.id]&&E(window.latestChannelsData[t.id].users));!window.currentRoom||window.currentRoom===t.id&&window.currentGroup===window.selectedGroup||window.leaveRoomInternal(e),window.currentGroup=window.selectedGroup,A(e,window.applyAudioStates,{value:window.hasMic}).finally((()=>{const n=c?c.textContent:"";window.joinRoom(e,window.currentGroup,t.id,t.name,n,g,window.showChannelStatusPanel,{value:window.currentRoomType})})),n.classList.add("connected")})),n}(t),function(e){e.setAttribute("draggable","true"),e.addEventListener("dragstart",(t=>{var n;ye=e,t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(new Image,0,0),n=e.querySelector(".channel-header .channel-name")?.textContent||"",pe=document.createElement("div"),pe.classList.add("channel-drag-preview"),pe.textContent=n,document.body.appendChild(pe),we=document.createElement("div"),we.classList.add("channel-placeholder"),e.parentNode.insertBefore(we,e.nextSibling),e.classList.add("dragging")})),e.addEventListener("dragend",(()=>{ve(),we&&we.remove(),we=null,e.classList.remove("dragging"),ye=null}))}(n)),t.categoryId?(d[t.categoryId]||(d[t.categoryId]=[]),d[t.categoryId].push(n)):i.push(n)}})),T(y,i),Object.entries(r).forEach((([t,n])=>{T(n,d[t]||[]),Ce(e,n,y)})),y.querySelectorAll(".category-row").forEach(M),Ce(e,y,y);const s=l.querySelector(`.grp-item[data-group-id="${window.selectedGroup}"]`),u=Object.values(window.channelUnreadCounts[window.selectedGroup]||{}).reduce(((e,t)=>e+(Number(t)||0)),0);if(window.unreadCounter[window.selectedGroup]=u,s){let e=s.querySelector(".unread-dot");u>0?(e||(e=document.createElement("span"),e.className="unread-dot",s.appendChild(e)),s.classList.add("unread")):(e&&e.remove(),s.classList.remove("unread"))}if(n&&t.some((e=>e.id===n))){const e=y.querySelector(`.channel-item[data-room-id="${n}"]`);return void(e&&e.classList.add("connected"))}const m=(()=>{try{return localStorage.getItem(`lastTextChannel:${window.selectedGroup}`)}catch(e){return null}})();let p=null;if(m&&t.some((e=>e.id===m&&"text"===e.type)))p=m;else{const e=t.find((e=>"text"===e.type));e&&(p=e.id)}if(p){const e=y.querySelector(`.channel-item[data-room-id="${p}"]`);e&&e.click()}})),e.on("joinRoomAck",(({groupId:t,roomId:n})=>{window.currentGroup=t,window.currentRoom=n,window.currentRoomType="voice","function"==typeof window.showChannelStatusPanel&&window.showChannelStatusPanel(),I&&L?U(e,window.currentGroup,window.currentRoom):A(e,window.applyAudioStates,{value:window.hasMic}).finally((()=>{U(e,window.currentGroup,window.currentRoom)}))})),e.on("newProducer",(({producerId:t})=>{C&&q(e,window.currentGroup,window.currentRoom,t)})),e.on("screenShareEnded",(({userId:t,username:n})=>{"function"==typeof window.clearScreenShareUI&&window.clearScreenShareUI();const a=document.querySelector(".channel-content-area");B&&a&&a.contains(B)?a.removeChild(B):x&&a&&a.contains(x)&&a.removeChild(x),window.screenShareVideo&&window.screenShareVideo.dataset.peerId===t&&e.emit("stopWatching",{userId:t}),window.screenShareVideo=null,window.screenShareContainer=null;const o=t===e.id?"Yayınınız sonlandırıldı":`${n||"Bir kullanıcı"} adlı kullanıcının yayını sonlandırıldı`;window.displayScreenShareEndedMessage(o)})),e.on("screenShareWatchers",(e=>{window.screenShareWatchers=e,window.latestChannelsData&&f(window.latestChannelsData)})),e.on("roomUsers",(e=>{"voice"===window.currentRoomType&&E(e)})),e.on("allChannelsData",(e=>{window.latestChannelsData=e,f(e),"voice"===window.currentRoomType&&window.currentRoom&&e[window.currentRoom]&&E(e[window.currentRoom].users)})),e.on("avatarUpdated",(({username:e,avatar:t})=>{window.userAvatars[e]=t,document.querySelectorAll(`[data-username="${e}"]`).forEach((e=>{"IMG"===e.tagName?e.src=t||"/images/default-avatar.png":e.style.backgroundImage=`url(${t||"/images/default-avatar.png"})`}))})),e.on("forceLogout",(()=>{n.style.display="none",t.style.display="block",window.username=null}))}function Ie(e){const t=document.querySelector("#userSettingsPage .settings-content");t&&("Hesabım"===e?(t.innerHTML='\n      <h1 class="account-title">Hesabım</h1>\n      <div class="account-tabs">\n        <button class="account-tab active">Güvenlik</button>\n        <button class="account-tab">Durum</button>\n      </div>\n      <div class="account-card">\n        <div class="cover-strip"></div>\n        <div class="profile-block">\n          <div class="profile-avatar" id="profile-avatar">\n            <img id="avatarImage" src="/images/default-avatar.png" alt="" />\n            <div class="avatar-overlay"><span class="material-symbols-outlined">edit</span></div>\n          </div>\n          <h1 class="display-name" id="displayNameHeading">Gösterim Adı</h1>\n          <button class="edit-profile-btn">Kullanıcı Profilini Düzenle</button>\n        </div>\n        <div class="info-card">\n          <div class="info-row" id="displayNameRow" data-label="Görünen Ad" data-field="displayName">\n            <div>\n              <div class="info-label">Görünen Ad</div>\n              <div class="info-value">Kullanıcının Görünen Adı</div>\n            </div>\n            <button class="edit-btn" id="editDisplayNameBtn">Düzenle</button>\n          </div>\n        <div class="info-row" id="userHandleRow" data-label="Kullanıcı adı" data-field="username">\n          <div>\n            <div class="info-label">Kullanıcı adı</div>\n            <div class="info-value">Kullanıcının Kullanıcı Adı</div>\n          </div>\n          <button class="edit-btn" id="editUserHandleBtn">Düzenle</button>\n        </div>\n        <div class="info-row" id="emailRow" data-label="E-Posta" data-field="email">\n          <div>\n            <div class="info-label">E-Posta</div>\n            <div class="info-value">**********@gmail.com</div>\n          </div>\n          <button class="edit-btn" id="editEmailBtn">Düzenle</button>\n        </div>\n        <div class="info-row" id="phoneRow" data-label="Telefon Numarası" data-field="phone">\n          <div>\n            <div class="info-label">Telefon Numarası</div>\n            <div class="info-value">+90 5** *** ** **</div>\n          </div>\n          <div class="info-actions">\n            <div class="remove-link" id="removePhoneLink">Kaldır</div>\n            <button class="edit-btn" id="editPhoneBtn">Düzenle</button>\n          </div>\n        </div>\n      </div>\n      </div>',function(){const e=(()=>{try{return localStorage.getItem("username")}catch(e){return null}})();if(e){const t=window.getAuthToken();fetch("/api/user/me",{headers:t?{Authorization:`Bearer ${t}`}:void 0}).then((e=>e.ok?e.json():null)).then((e=>{if(!e)return;const t=document.getElementById("displayNameHeading");t&&(t.textContent=e.displayName||"");const n=(e,t)=>{const n=document.querySelector(`#${e} .info-value`);n&&(n.textContent=t||"—")};n("displayNameRow",e.displayName),n("userHandleRow",e.username),n("emailRow",e.email),n("phoneRow",e.phone)})).catch((()=>{})),window.loadAvatar(e).then((e=>{const t=document.getElementById("avatarImage");t&&(t.src=e)}))}const t=document.getElementById("editEmailBtn"),n=document.getElementById("editPhoneBtn"),a=document.getElementById("editUserHandleBtn"),o=document.getElementById("removePhoneLink"),i=document.getElementById("profile-avatar");a&&a.addEventListener("click",Be),t&&t.addEventListener("click",Me),n&&n.addEventListener("click",Te),o&&o.addEventListener("click",(()=>be("removePhoneConfirmModal"))),i&&i.addEventListener("click",(()=>be("avatarUploadModal")));const r=document.getElementById("closeAvatarUploadModal"),d=document.getElementById("avatarFileInput"),s=document.getElementById("saveAvatarBtn"),l=document.getElementById("avatarCropContainer"),c=document.getElementById("cancelAvatarUploadBtn");r&&r.addEventListener("click",(()=>{Ae&&(Ae.destroy(),Ae=null),ke("avatarUploadModal")})),c&&c.addEventListener("click",(()=>ke("avatarUploadModal"))),d&&d.addEventListener("change",(()=>{const e=d.files[0];if(!e)return;if(e.size>2097152)return alert("Dosya 2 MB'dan büyük"),void(d.value="");const t=URL.createObjectURL(e);l.innerHTML=`<img id="avatarCropImage" src="${t}" />`;const n=document.getElementById("avatarCropImage");Ae&&Ae.destroy(),Ae=new Cropper(n,{aspectRatio:1})})),s&&s.addEventListener("click",(()=>{if(!Ae)return;const e=Ae.getCroppedCanvas({width:256,height:256});if(!e)return void console.error("Failed to crop avatar: canvas is null");const t=e.toDataURL("image/png"),n=document.getElementById("avatarImage");n&&(n.src=t);const a=localStorage.getItem("username"),o=window.getAuthToken();fetch(`/api/user/avatar?username=${encodeURIComponent(a)}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:void 0},body:JSON.stringify({avatar:t})}).then((()=>{try{localStorage.setItem("avatar",t)}catch(e){}})).catch((()=>{})),Ae.destroy(),Ae=null,ke("avatarUploadModal")}));const u=document.getElementById("cancelRemovePhoneBtn"),m=document.getElementById("confirmRemovePhoneBtn"),p=document.getElementById("closeRemovePhoneConfirmModal");p&&p.addEventListener("click",(()=>ke("removePhoneConfirmModal"))),u&&u.addEventListener("click",(()=>ke("removePhoneConfirmModal"))),m&&m.addEventListener("click",(()=>{const e=document.querySelector("#phoneRow .info-value");e&&(e.textContent="—"),localStorage.getItem("username");const t=window.getAuthToken();fetch("/api/user/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:void 0},body:JSON.stringify({field:"phone",value:""})}).catch((()=>{})),ke("removePhoneConfirmModal")}));const w=document.querySelector(".edit-profile-btn");if(w){const e=document.getElementById("userSettingsPage"),t=e?e.querySelector('.settings-menu li[data-section="profile"]'):null,n=e?e.querySelectorAll(".settings-menu li"):[];w.addEventListener("click",(()=>{if(t){n.forEach((e=>e.classList.remove("active"))),t.classList.add("active"),Ie(t.textContent.trim());try{localStorage.setItem("lastSettingsTab",t.dataset.section||t.textContent.trim())}catch(e){}}}))}}()):t.innerHTML=`<h2>${e}</h2>`)}const Se=["editUsernameModal","editEmailModal","editPhoneModal","removePhoneConfirmModal","avatarUploadModal","removeAvatarModal"];function be(e){const t=document.getElementById(e);t&&(t.style.display="flex",t.classList.add("active"),Se.includes(e)&&document.body.classList.add("blurred"),t._untrap=function(e){const t=Array.from(e.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])'));if(!t.length)return()=>{};const n=t[0],a=t[t.length-1];function o(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),n.focus()))}return e.addEventListener("keydown",o),setTimeout((()=>n.focus()),0),()=>e.removeEventListener("keydown",o)}(t))}function ke(e){const t=document.getElementById(e);t&&(t.style.display="none",t.classList.remove("active"),"function"==typeof t._untrap&&(t._untrap(),t._untrap=null),Se.includes(e))&&(Se.some((e=>{const t=document.getElementById(e);return t&&t.classList.contains("active")}))||document.body.classList.remove("blurred"))}function xe(e){const t=document.getElementById("toast");t&&(t.textContent=e,t.style.display="block",setTimeout((()=>{t.style.display="none"}),2e3))}function Be(){const e=document.getElementById("editUsernameModal");if(!e)return;const t=e.querySelector("input"),n=e.querySelector(".modal-buttons .btn.primary"),a=e.querySelector(".modal-buttons .btn.secondary"),o=e.querySelector(".modal-error"),i=e.querySelector(".close-modal");function r(e){o&&(o.textContent=e,o.style.display="block")}function d(){ke("editUsernameModal"),document.removeEventListener("keydown",s),t&&t.removeEventListener("input",l)}function s(e){"Escape"===e.key&&d()}function l(){o&&(o.textContent="",o.style.display="none"),n&&(n.disabled=""===t.value.trim())}i&&i.addEventListener("click",d,{once:!0}),a&&a.addEventListener("click",d,{once:!0}),document.addEventListener("keydown",s),t&&(t.addEventListener("input",l),t.addEventListener("keydown",(e=>{"Enter"===e.key&&n&&!n.disabled&&n.click()}))),n&&(n.addEventListener("click",(async function e(){if(n.disabled)return;const a=t.value.trim();if(!a)return void r("Bu alan boş bırakılamaz");n.disabled=!0;const o=n.innerHTML;n.innerHTML='<span class="spinner"></span>';try{localStorage.getItem("username");const e=window.getAuthToken(),t=await fetch("/api/user/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:void 0},body:JSON.stringify({field:"username",value:a})});if(!t.ok){const e=await t.json().catch((()=>({})));return void("invalid_username"===e.error?r("Geçersiz kullanıcı adı"):"username_taken"===e.error?r("Bu kullanıcı adı kullanımda"):r(e.error||"Sunucu hatası"))}const n=document.querySelector("#userHandleRow .info-value");n&&(n.textContent=a);try{localStorage.setItem("username",a)}catch(e){}xe("Changes saved"),d()}catch(e){r("Sunucu hatası")}finally{n.innerHTML=o,n.disabled=!1,n.removeEventListener("click",e)}}),{once:!0}),n.disabled=""===t.value.trim()),be("editUsernameModal")}function Me(){const e=document.getElementById("editEmailModal");if(!e)return;const t=e.querySelector("input"),n=e.querySelector(".modal-buttons .btn.primary"),a=e.querySelector(".modal-buttons .btn.secondary"),o=e.querySelector(".modal-error"),i=e.querySelector(".close-modal");function r(e){o&&(o.textContent=e,o.style.display="block")}function d(){ke("editEmailModal"),document.removeEventListener("keydown",s),t&&t.removeEventListener("input",l)}function s(e){"Escape"===e.key&&d()}function l(){o&&(o.textContent="",o.style.display="none"),n&&(n.disabled=""===t.value.trim())}i&&i.addEventListener("click",d,{once:!0}),a&&a.addEventListener("click",d,{once:!0}),document.addEventListener("keydown",s),t&&(t.addEventListener("input",l),t.addEventListener("keydown",(e=>{"Enter"===e.key&&n&&!n.disabled&&n.click()}))),n&&(n.addEventListener("click",(async function e(){if(n.disabled)return;const a=t.value.trim();if(!a)return void r("Bu alan boş bırakılamaz");n.disabled=!0;const o=n.innerHTML;n.innerHTML='<span class="spinner"></span>';try{localStorage.getItem("username");const e=window.getAuthToken(),t=await fetch("/api/user/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:void 0},body:JSON.stringify({field:"email",value:a})});if(!t.ok)return void r((await t.json().catch((()=>({})))).error||"Sunucu hatası");const n=document.querySelector("#emailRow .info-value");n&&(n.textContent=a),xe("Changes saved"),d()}catch(e){r("Sunucu hatası")}finally{n.innerHTML=o,n.disabled=!1,n.removeEventListener("click",e)}}),{once:!0}),n.disabled=""===t.value.trim()),be("editEmailModal")}function Te(){const e=document.getElementById("editPhoneModal");if(!e)return;const t=e.querySelector("input"),n=e.querySelector(".modal-buttons .btn.primary"),a=e.querySelector(".modal-buttons .btn.secondary"),o=e.querySelector(".modal-error"),i=e.querySelector(".close-modal");function r(e){o&&(o.textContent=e,o.style.display="block")}function d(){ke("editPhoneModal"),document.removeEventListener("keydown",s),t&&t.removeEventListener("input",l)}function s(e){"Escape"===e.key&&d()}function l(){o&&(o.textContent="",o.style.display="none"),n&&(n.disabled=""===t.value.trim())}i&&i.addEventListener("click",d,{once:!0}),a&&a.addEventListener("click",d,{once:!0}),document.addEventListener("keydown",s),t&&(t.addEventListener("input",l),t.addEventListener("keydown",(e=>{"Enter"===e.key&&n&&!n.disabled&&n.click()}))),n&&(n.addEventListener("click",(async function e(){if(n.disabled)return;const a=t.value.trim();if(!a)return void r("Bu alan boş bırakılamaz");n.disabled=!0;const o=n.innerHTML;n.innerHTML='<span class="spinner"></span>';try{localStorage.getItem("username");const e=window.getAuthToken(),t=await fetch("/api/user/me",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:void 0},body:JSON.stringify({field:"phone",value:a})});if(!t.ok)return void r((await t.json().catch((()=>({})))).error||"Sunucu hatası");const n=document.querySelector("#phoneRow .info-value");n&&(n.textContent=a),xe("Changes saved"),d()}catch(e){r("Sunucu hatası")}finally{n.innerHTML=o,n.disabled=!1,n.removeEventListener("click",e)}}),{once:!0}),n.disabled=""===t.value.trim()),be("editPhoneModal")}window.showToast=xe;let Ae=null;function Ue(){const e=document.getElementById("userSettingsPage");if(!e)return;const t=e.querySelectorAll(".settings-menu li"),n=e.querySelector('.settings-menu li[data-section="logout"]'),a=document.getElementById("logoutConfirmModal"),o=document.getElementById("confirmLogoutBtn"),i=document.getElementById("cancelLogoutBtn"),r=(()=>{try{return localStorage.getItem("lastSettingsTab")}catch(e){return null}})();let d=r?e.querySelector(`.settings-menu li[data-section="${r}"]`):null;d||(d=e.querySelector('.settings-menu li[data-section="account"]')),d&&(t.forEach((e=>e.classList.remove("active"))),d.classList.add("active"),Ie(d.textContent.trim())),e.dataset.initialized||(t.forEach((e=>{e.addEventListener("click",(()=>{if(e!==n){t.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),Ie(e.textContent.trim());try{localStorage.setItem("lastSettingsTab",e.dataset.section||e.textContent.trim())}catch(e){}}else a&&(a.style.display="flex")}))})),o&&o.addEventListener("click",(()=>{a&&(a.style.display="none"),Ne();try{localStorage.removeItem("username")}catch(e){}window.location.reload()})),i&&i.addEventListener("click",(()=>{a&&(a.style.display="none")})),e.dataset.initialized="true")}function Ne(){const e=document.getElementById("userSettingsPage"),t=document.getElementById("callScreen");e&&(e.style.display="none"),t&&(t.style.display="flex")}function De(){if(document.querySelector(".channel-content-area"),B?(B.parentNode&&B.parentNode.removeChild(B),T(null),M(null)):x&&(x.parentNode&&x.parentNode.removeChild(x),M(null)),!window.screenShareProducerVideo&&wt){wt.classList.remove("active");const e=wt.querySelector(".material-icons");e&&(e.textContent="desktop_windows")}if(!window.screenShareProducerVideo&&gt){gt.classList.remove("active");const e=gt.querySelector(".material-icons, .material-icons-outlined");e&&(e.textContent="desktop_windows")}const e=document.getElementById("screenShareOverlay");e&&e.parentNode&&e.parentNode.removeChild(e),window.removeScreenShareEndedMessage&&window.removeScreenShareEndedMessage();const t=document.getElementById("channelUsersContainer");t&&(t.classList.remove("broadcast-mode"),t.style.display="grid",t.style.flexDirection="",t.style.justifyContent=""),window.broadcastingUserId=null,window.latestChannelsData&&window.currentRoom&&"function"==typeof window.renderVoiceChannelGrid&&window.latestChannelsData[window.currentRoom]&&window.renderVoiceChannelGrid(window.latestChannelsData[window.currentRoom].users)}window.clearScreenShareUI=De;let Ge,qe,Re,Pe=null,$e=localStorage.getItem("lastGroupId")||null;window.getAuthToken=function(){try{const e=localStorage.getItem("token");if(e)return e}catch(e){}return Pe&&Pe.auth&&Pe.auth.token?Pe.auth.token:null},"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((e=>{window.swRegistration=e})).catch((e=>console.warn("Service worker registration failed",e))),window.cacheUploadUrls=function(e){if(!Array.isArray(e)||!e.length||!navigator.serviceWorker)return;const t=t=>{t.active&&t.active.postMessage({type:"cache-uploads",urls:e})};window.swRegistration?t(window.swRegistration):navigator.serviceWorker.getRegistration("/sw.js").then((e=>{e&&t(e)}))},window.userAvatars={},window.loadAvatar=async function(e){if(!e)return null;if(window.userAvatars[e])return window.userAvatars[e];try{let t=window.getAuthToken(),n=t?{Authorization:`Bearer ${t}`}:void 0,a=await fetch(`/api/user/avatar?username=${encodeURIComponent(e)}`,{headers:n});if(401===a.status){const n=window.getAuthToken();!t&&n&&(a=await fetch(`/api/user/avatar?username=${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${n}`}}))}if(a.ok){const t=await a.json();window.userAvatars[e]=t.avatar||"/images/default-avatar.png"}else window.userAvatars[e]="/images/default-avatar.png"}catch(t){window.userAvatars[e]="/images/default-avatar.png"}return window.userAvatars[e]},window.groupNotifyType={},window.channelNotifyType={},window.openNotifyTarget=null,window.openNotifyType=null;const ze=document.getElementById("groupList"),He=document.getElementById("createGroupButton"),je=document.getElementById("roomList"),Oe=document.getElementById("groupTitle"),_e=document.getElementById("groupDropdownIcon"),Ve=document.getElementById("groupDropdownMenu"),Fe=document.getElementById("copyGroupIdBtn"),We=document.getElementById("renameGroupBtn"),Ye=document.getElementById("createChannelBtn"),Ke=document.getElementById("deleteGroupBtn"),Je=document.getElementById("groupSettingsBtn"),Xe=document.getElementById("leaveGroupBtn"),Qe=document.getElementById("toggleDMButton"),Ze=document.getElementById("roomPanel"),et=document.getElementById("rightPanel"),tt=(document.getElementById("userList"),document.getElementById("toggleUserListButton")),nt=document.getElementById("channelStatusPanel");nt.style.zIndex="20",nt.style.display="flex";const at=document.getElementById("connectionStatusText"),ot=(document.getElementById("pingValue"),document.getElementById("cellBar1"),document.getElementById("cellBar2"),document.getElementById("cellBar3"),document.getElementById("cellBar4"),nt.querySelector(".connection-header")),it=nt.querySelector(".channel-info-row"),rt=nt.querySelector(".button-row"),dt=nt.querySelector(".panel-divider"),st=nt.querySelector(".user-card");function lt(){ot&&(ot.style.display="flex"),it&&(it.style.display="flex"),rt&&(rt.style.display="flex"),dt&&(dt.style.display="block"),st&&(st.style.display="flex")}function ct(){ot&&(ot.style.display="none"),it&&(it.style.display="none"),rt&&(rt.style.display="none"),dt&&(dt.style.display="none"),st&&(st.style.display="flex")}function ut(e){at&&(at.classList.remove("status-connected","status-connecting"),"connected"===e?(at.textContent="Kanala bağlanıldı",at.classList.add("status-connected")):(at.textContent="RTC Bağlanıyor",at.classList.add("status-connecting")))}function mt(){"voice"===window.currentRoomType&&(nt&&(nt.style.display="flex",lt()),ut("connecting"),m(0),function(e){const t=document.getElementById("pingValue");c&&clearInterval(c),c=setInterval((()=>{let n=0;e&&e.io&&e.io.engine&&e.io.engine.lastPingTimestamp?(n=Date.now()-e.io.engine.lastPingTimestamp,t&&(t.textContent=n+" ms")):t&&(t.textContent=""),m(n),u(n)}),1e3)}(Pe))}window.showChannelStatusPanel=mt,window.hideChannelStatusPanel=function(){nt&&(nt.style.display="none"),function(){const e=document.getElementById("pingValue");c&&(clearInterval(c),c=null),e&&(e.textContent=""),u(0)}()},window.setConnectionStatus=ut,window.showVoiceSections=lt,window.hideVoiceSections=ct;const pt=document.getElementById("leaveButton"),wt=document.getElementById("screenShareButton"),yt=document.getElementById("cameraShareButton"),gt=document.getElementById("screenShareLargeButton"),ht=document.getElementById("soundbarButton"),ft=document.getElementById("micToggleButton"),vt=document.getElementById("deafenToggleButton"),Et=document.getElementById("settingsButton"),Ct=document.getElementById("textChannelContainer"),Lt=document.getElementById("textMessages"),It=document.getElementById("textChatInputBar"),St=document.getElementById("textChannelMessageInput"),bt=document.getElementById("micMessageBtn"),kt=document.getElementById("sendTextMessageBtn"),xt=document.getElementById("selectedChannelTitle"),Bt=document.getElementById("channelContentArea"),Mt=document.getElementById("dmContentArea"),Tt=document.getElementById("dmPanel"),At=document.getElementById("groupModal"),Ut=document.getElementById("modalGroupCreateBtn"),Nt=document.getElementById("modalGroupJoinBtn"),Dt=document.getElementById("actualGroupCreateModal"),Gt=document.getElementById("actualGroupName"),qt=document.getElementById("actualGroupNameBtn"),Rt=document.getElementById("closeCreateGroupModal"),Pt=document.getElementById("joinGroupModal"),$t=document.getElementById("joinGroupIdInput"),zt=document.getElementById("joinGroupIdBtn"),Ht=document.getElementById("closeJoinGroupModal"),jt=document.getElementById("groupSettingsModal"),Ot=document.getElementById("closeGroupSettingsModal"),_t=document.getElementById("userSettingsPage"),Vt=document.getElementById("closeUserSettingsPageBtn"),Ft=document.getElementById("roomModal"),Wt=document.getElementById("modalRoomName"),Yt=document.getElementById("textChannel"),Kt=document.getElementById("voiceChannel"),Jt=document.getElementById("modalCreateRoomBtn"),Xt=document.getElementById("modalCloseRoomBtn"),Qt=document.getElementById("createCategoryBtn"),Zt=document.getElementById("categoryModal"),en=document.getElementById("modalCategoryName"),tn=document.getElementById("modalCreateCategoryBtn"),nn=document.getElementById("modalCloseCategoryBtn");Object.assign(window,{loginScreen:Ge,registerScreen:qe,callScreen:Re,groupListDiv:ze,createGroupButton:He,roomListDiv:je,groupTitle:Oe,groupDropdownIcon:_e,groupDropdownMenu:Ve,copyGroupIdBtn:Fe,renameGroupBtn:We,createChannelBtn:Ye,groupSettingsBtn:Je,leaveGroupBtn:Xe,deleteGroupBtn:Ke,toggleDMButton:Qe,roomPanel:Ze,rightPanel:et,leaveButton:pt,screenShareButton:wt,micToggleButton:ft,deafenToggleButton:vt,settingsButton:Et,textChannelContainer:Ct,textMessages:Lt,textChatInputBar:It,textChannelMessageInput:St,micMessageBtn:bt,sendTextMessageBtn:kt,selectedChannelTitle:xt,channelContentArea:Bt,dmContentArea:Mt,dmPanel:Tt,cameraShareButton:yt,screenShareLargeButton:gt,toggleUserListButton:tt,soundbarButton:ht,groupModal:At,modalGroupCreateBtn:Ut,modalGroupJoinBtn:Nt,actualGroupCreateModal:Dt,actualGroupName:Gt,actualGroupNameBtn:qt,closeCreateGroupModal:Rt,joinGroupModal:Pt,joinGroupIdInput:$t,joinGroupIdBtn:zt,closeJoinGroupModal:Ht,groupSettingsModal:jt,closeGroupSettingsModal:Ot,userSettingsPage:_t,closeUserSettingsPageBtn:Vt,roomModal:Ft,modalRoomName:Wt,textChannel:Yt,voiceChannel:Kt,modalCreateRoomBtn:Jt,modalCloseRoomBtn:Xt,createCategoryBtn:Qt,categoryModal:Zt,modalCategoryName:en,modalCreateCategoryBtn:tn,modalCloseCategoryBtn:nn,attemptLogin:function(e,t,n){const a=(t||"").trim(),o=(n||"").trim();return a&&o?(e.emit("login",{username:a,password:o}),{ok:!0}):{ok:!1,message:"Lütfen gerekli alanları doldurunuz"}},attemptRegister:function(e,t){const n=(t.username||"").trim(),a=(t.name||"").trim(),o=(t.surname||"").trim(),i=(t.birthdate||"").trim(),r=(t.email||"").trim(),s=(t.phone||"").trim(),l=(t.password||"").trim(),c=(t.passwordConfirm||"").trim();return d.info("🔐 attemptRegister tetiklendi"),n&&a&&o&&i&&r&&s&&l&&c?n!==n.toLowerCase()?{ok:!1,message:"Kullanıcı adı sadece küçük harf olmalı!"}:l!==c?{ok:!1,message:"Parolalar eşleşmiyor!"}:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(l)?(e.emit("register",{username:n,name:a,surname:o,birthdate:i,email:r,phone:s,password:l,passwordConfirm:c}),{ok:!0}):{ok:!1,message:"Parola en az 8 karakter, büyük/küçük harf, rakam ve özel karakter içermeli."}:{ok:!1,message:"Lütfen tüm alanları doldurunuz."}}}),window.WebRTC=i,window.joinRoom=P,window.leaveRoomInternal=R;const an=window.leaveRoomInternal;function on(e,t){const n=document.getElementById("muteSubMenu");n&&n.remove();const a=document.createElement("div");a.id="muteSubMenu",a.className="context-menu",a.style.position="absolute";const o=e.getBoundingClientRect();a.style.top=o.top+"px",a.style.left=o.right+"px",a.style.display="flex",a.style.flexDirection="column",[{label:"15 dakika",ms:9e5},{label:"30 dakika",ms:18e5},{label:"1 saat",ms:36e5},{label:"3 saat",ms:108e5},{label:"8 saat",ms:288e5},{label:"24 saat",ms:864e5},{label:"Ben tekrar açana kadar",ms:-1}].forEach((n=>{const o=document.createElement("div");o.className="context-menu-item",o.textContent=n.label,o.addEventListener("click",(()=>{if("channel"===t){const t=window.selectedGroup,a=e.dataset.channelId;if(Pe.emit("muteChannel",{groupId:t,channelId:a,duration:n.ms}),window.channelMuteUntil[t]||(window.channelMuteUntil[t]={}),n.ms>0?window.channelMuteUntil[t][a]=Date.now()+n.ms:-1===n.ms?window.channelMuteUntil[t][a]=1/0:delete window.channelMuteUntil[t][a],t===window.selectedGroup){const e=document.querySelector(`.channel-item[data-room-id="${a}"]`);e&&(n.ms>0||-1===n.ms?e.classList.add("muted","channel-muted"):e.classList.remove("muted","channel-muted"))}}else if("group"===t){const t=e.dataset.groupId;Pe.emit("muteGroup",{groupId:t,duration:n.ms})}else if("category"===t){const t=e.dataset.categoryId;Pe.emit("muteCategory",{groupId:window.selectedGroup,categoryId:t,duration:n.ms})}a.remove();const o="channel"===t?"channelContextMenu":"group"===t?"groupContextMenu":"categoryContextMenu",i=document.getElementById(o);i&&i.remove()})),a.appendChild(o)})),document.body.appendChild(a);const i=t=>{const n=t.relatedTarget;e.contains(n)||a.contains(n)||(a.remove(),e.removeEventListener("mouseleave",i),a.removeEventListener("mouseleave",i))};e.addEventListener("mouseleave",i),a.addEventListener("mouseleave",i),document.addEventListener("click",(function e(){const t=document.getElementById("muteSubMenu");t&&t.remove(),document.removeEventListener("click",e)}))}function rn(e,t){const n=document.getElementById("notifySubMenu");n&&n.remove(),window.openNotifyTarget=e,window.openNotifyType=t;const a=document.createElement("div");a.id="notifySubMenu",a.className="context-menu",a.style.position="absolute";const o=e.getBoundingClientRect();a.style.top=o.top+"px",a.style.left=o.right+"px",a.style.display="flex",a.style.flexDirection="column";const i="group"===t?e.dataset.groupId:window.selectedGroup,r="channel"===t?e.dataset.channelId:null;let d="all";"channel"===t&&window.channelNotifyType[i]?d=window.channelNotifyType[i][r]||d:"group"===t&&(d=window.groupNotifyType[i]||d),[{label:"Bütün mesajlar",value:"all"},{label:"Sadece bahsetmeler",value:"mentions"},{label:"Hiçbir şey",value:"nothing"}].forEach((e=>{const n=document.createElement("div");if(n.className="context-menu-item",n.textContent=e.label,e.value===d){const e=document.createElement("span");e.classList.add("material-icons"),e.textContent="check",n.appendChild(e)}n.addEventListener("click",(()=>{"channel"===t?(Pe.emit("setChannelNotifyType",{groupId:i,channelId:r,type:e.value}),window.channelNotifyType[i]=window.channelNotifyType[i]||{},window.channelNotifyType[i][r]=e.value):(Pe.emit("setGroupNotifyType",{groupId:i,type:e.value}),window.groupNotifyType[i]=e.value),a.remove();const n=document.getElementById("channel"===t?"channelContextMenu":"groupContextMenu");n&&n.remove(),window.openNotifyTarget=null,window.openNotifyType=null})),a.appendChild(n)})),document.body.appendChild(a);const s=t=>{const n=t.relatedTarget;e.contains(n)||a.contains(n)||(a.remove(),e.removeEventListener("mouseleave",s),a.removeEventListener("mouseleave",s))};e.addEventListener("mouseleave",s),a.addEventListener("mouseleave",s),document.addEventListener("click",(function e(){const t=document.getElementById("notifySubMenu");t&&t.remove(),window.openNotifyTarget=null,window.openNotifyType=null,document.removeEventListener("click",e)}))}window.leaveRoomInternal=function(...e){return window.channelAreaResizeObserver&&(window.channelAreaResizeObserver.disconnect(),window.channelAreaResizeObserver=null),window.channelAreaResizeHandler&&(window.removeEventListener("resize",window.channelAreaResizeHandler),window.channelAreaResizeHandler=null),an.apply(this,e)},["device","deviceIsLoaded","sendTransport","recvTransport","localStream","audioPermissionGranted","localProducer","consumers","remoteAudios","screenShareVideo","screenShareContainer"].forEach((e=>{Object.defineProperty(window,e,{get:()=>i[e],set(t){"screenShareVideo"===e?M(t):"screenShareContainer"===e?T(t):i[e]=t}})})),Object.assign(window,{selectedGroup:$e,currentGroup:null,currentRoom:null,currentTextChannel:null,currentRoomType:null,activeVoiceChannelName:"",activeVoiceGroupName:"",micEnabled:!0,selfDeafened:!1,micWasEnabledBeforeDeaf:!1,hasMic:!0}),window.applyAudioStates=e=>{e||(e={localProducer:S,localStream:L,socket:Pe,micEnabled:window.micEnabled,selfDeafened:window.selfDeafened,micToggleButton:ft,deafenToggleButton:vt,remoteAudios:k,hasMic:window.hasMic}),function({localProducer:e,localStream:t,socket:n,micEnabled:a,selfDeafened:o,micToggleButton:i,deafenToggleButton:r,remoteAudios:d,hasMic:s}){if(e)if(a&&!o)e.resume(),y[n.id]||g(t,n.id);else{e.pause(),h(n.id);const t=document.getElementById(`avatar-${n.id}`);t&&t.classList.remove("speaking")}const l=[r];[i].forEach((e=>{e&&(!a||o?(e.innerHTML='<span class="material-icons">mic_off</span>',e.classList.add("btn-muted","muted")):(e.innerHTML='<span class="material-icons">mic</span>',e.classList.remove("btn-muted","muted")))})),l.forEach((e=>{e&&(o?(e.innerHTML='<span class="material-icons">headset_off</span>',e.classList.add("btn-muted","muted")):(e.innerHTML='<span class="material-icons">headset</span>',e.classList.remove("btn-muted","muted")))})),d.forEach((e=>{e.muted=o})),n.emit("audioStateChanged",{micEnabled:a,selfDeafened:o,hasMic:s})}(e)},window.addEventListener("DOMContentLoaded",(()=>{Ge=document.getElementById("loginScreen"),qe=document.getElementById("registerScreen"),Re=document.getElementById("callScreen"),Object.assign(window,{loginScreen:Ge,registerScreen:qe,callScreen:Re}),Qe.querySelector(".material-icons").textContent="forum",ct();const e=window.SOCKET_URL||window.location.origin,t=(()=>{try{return localStorage.getItem("token")}catch(e){return null}})();Pe=io(e,{transports:["websocket"],auth:t?{token:t}:{}}),window.socket=Pe,Le(Pe),(0,ae.fF)(Pe),ne(Pe),function(e,t,n){const a=document.getElementById("textChannelMessageInput");if(!a)return void console.error("Text chat input field (id='textChannelMessageInput') bulunamadı!");let o=document.getElementById("typingIndicator");o||(o=document.createElement("div"),o.id="typingIndicator",o.classList.add("typing-indicator"),o.style.position="absolute",o.style.top="calc(100% + 5px)",o.style.left="10px",o.style.fontSize="0.9em",o.style.color="#aaa",o.style.visibility="hidden",o.setAttribute("data-channel",t()),a.parentElement.appendChild(o));let i=new Set;function r(){if(i.size>0){const e=Array.from(i).join(", ");o.textContent=e+" yazıyor...",o.style.visibility="visible"}else o.textContent="",o.style.visibility="hidden"}e.on("typing",(e=>{e.channel===t()&&e.username!==n()&&(i.add(e.username),r())})),e.on("stop typing",(e=>{e.channel===t()&&e.username!==n()&&(i.delete(e.username),r())}));let d=null;a.addEventListener("input",(()=>{o.setAttribute("data-channel",t()),""!==(void 0!==a.value?a.value:a.innerText).trim()?(e.emit("typing",{username:n(),channel:t()}),d||(d=setInterval((()=>{""!==(void 0!==a.value?a.value:a.innerText).trim()?e.emit("typing",{username:n(),channel:t()}):(clearInterval(d),d=null,e.emit("stop typing",{username:n(),channel:t()}))}),2e3))):(d&&(clearInterval(d),d=null),e.emit("stop typing",{username:n(),channel:t()}))})),setInterval((function(){const e=t();o.getAttribute("data-channel")!==e&&(o.setAttribute("data-channel",e),i.clear(),r())}),500),e.on("updateCurrentChannel",(e=>{e&&e.channel&&(o.setAttribute("data-channel",e.channel),i.clear(),r())})),document.addEventListener("channelChanged",(e=>{e.detail&&e.detail.newChannel&&(o.setAttribute("data-channel",e.detail.newChannel),i.clear(),r())}))}(Pe,(()=>window.currentTextChannel),(()=>window.username)),function(e){function t(){document.querySelectorAll(".dm-friends-button.selected").forEach((e=>e.classList.remove("selected"))),document.querySelectorAll(".dm-content-item.selected").forEach((e=>e.classList.remove("selected")))}e.on("friendListUpdated",(()=>{const e=document.getElementById("dmPanel");window.isDMMode&&e&&"none"!==e.style.display&&d()}));const n=document.getElementById("dmChannelTitle");if(!n)return void console.error("dmChannelTitle not found");function a(){let e=document.getElementById("dmContentArea");if(!e){e=document.createElement("div"),e.id="dmContentArea",e.className="text-channel-container";const t=document.getElementById("selectedDMBar");t?t.parentNode.insertBefore(e,t.nextSibling):n.parentNode.insertBefore(e,n.nextSibling)}return e}function i(e){const t=document.createElement("div");return t.className="dm-content-item",t.textContent=e,t}document.addEventListener("click",(function(n){if(n.target.closest("#dmChannelTitle")&&n.target.classList.contains("dm-filter-item")){t();const r=n.target.getAttribute("data-filter"),d=a();if(d.style.display="block",d.innerHTML="","add"===r){const s=document.createElement("input");s.type="text",s.id="friendSearchInput",s.placeholder="Kullanıcı adı girin...",s.className="dm-search-input";const l=document.createElement("button");function c(){const t=s.value.trim();""!==t&&e.emit("sendFriendRequest",{to:t},(e=>{e.success?(alert("Arkadaşlık isteği gönderildi."),s.value=""):alert("İstek gönderilemedi: "+e.message)}))}l.textContent="Arkadaşlık İsteği Gönder",l.id="sendFriendRequestButton",l.className="dm-send-request-btn",d.appendChild(s),d.appendChild(l),l.addEventListener("click",c),s.addEventListener("keydown",(e=>{"Enter"===e.key&&c()}))}else"sent"===r?e.emit("getPendingFriendRequests",{},(t=>{e.emit("getOutgoingFriendRequests",{},(n=>{const a=document.createElement("h3");if(a.textContent="Gelen Arkadaşlık İstekleri",d.appendChild(a),t.success&&Array.isArray(t.requests)&&t.requests.length>0){const n=document.createElement("ul");t.requests.forEach((t=>{const a=document.createElement("li");a.className="dm-content-item",a.textContent=t.from;const o=document.createElement("button");o.className="friend-accept-btn",o.innerHTML='<span class="material-icons" style="color: green;">check</span>',o.addEventListener("click",(()=>{e.emit("acceptFriendRequest",{from:t.from},(e=>{e.success?(alert("Arkadaşlık isteği kabul edildi."),a.remove()):alert("İstek kabul edilemedi: "+e.message)}))}));const i=document.createElement("button");i.className="friend-reject-btn",i.innerHTML='<span class="material-icons" style="color: red;">close</span>',i.addEventListener("click",(()=>{e.emit("rejectFriendRequest",{from:t.from},(e=>{e.success?(alert("Arkadaşlık isteği reddedildi."),a.remove()):alert("İstek reddedilemedi: "+e.message)}))})),a.appendChild(o),a.appendChild(i),n.appendChild(a)})),d.appendChild(n)}else d.appendChild(i("Gelen arkadaşlık isteği bulunmuyor."));const o=document.createElement("h3");if(o.textContent="Gönderilen Arkadaşlık İstekleri",d.appendChild(o),n.success&&Array.isArray(n.requests)&&n.requests.length>0){const e=document.createElement("ul");n.requests.forEach((t=>{const n=document.createElement("li");n.className="dm-content-item",n.textContent=`To: ${t.to}`,e.appendChild(n)})),d.appendChild(e)}else d.appendChild(i("Gönderilen arkadaşlık isteği bulunmuyor."))}))})):"all"===r?e.emit("getFriendsList",{},(n=>{n.success&&Array.isArray(n.friends)?0===n.friends.length?d.appendChild(i("Hiç arkadaşınız yok.")):n.friends.forEach((n=>{const a=document.createElement("div");a.className="dm-content-item",a.textContent=n.username,a.addEventListener("click",(()=>{t(),a.classList.add("selected");const i=document.getElementById("selectedDMBar");if(i){i.innerHTML="";const e=document.createElement("h2");e.id="dmChannelTitle",e.className="dm-channel-title",e.textContent=n.username,i.appendChild(e)}o.e(774).then(o.bind(o,774)).then((t=>{t.initDMChat(e,n.username)})).catch((e=>console.error(e)))})),d.appendChild(a)})):d.appendChild(i("Arkadaşlar alınırken hata oluştu."))})):"online"===r?e.emit("getFriendsList",{},(n=>{if(n.success&&Array.isArray(n.friends))if(0===n.friends.length)d.appendChild(i("Hiç arkadaşınız yok."));else{const a=n.friends.filter((e=>e.online));0===a.length?d.appendChild(i("Çevrimiçi hiç arkadaşınız yok.")):a.forEach((n=>{const a=document.createElement("div");a.className="dm-content-item",a.textContent=n.username,a.addEventListener("click",(()=>{t(),a.classList.add("selected");const i=document.getElementById("selectedDMBar");if(i){i.innerHTML="";const e=document.createElement("h2");e.id="dmChannelTitle",e.className="dm-channel-title",e.textContent=n.username,i.appendChild(e)}o.e(774).then(o.bind(o,774)).then((t=>{t.initDMChat(e,n.username)})).catch((e=>console.error(e)))})),d.appendChild(a)}))}else d.appendChild(i("Arkadaşlar alınırken hata oluştu."))})):"blocked"===r&&e.emit("getBlockedFriends",{},(n=>{n.success&&Array.isArray(n.friends)?0===n.friends.length?d.appendChild(i("Engellenen arkadaş bulunmuyor.")):n.friends.forEach((n=>{const a=document.createElement("div");a.className="dm-content-item",a.textContent=n.username,a.addEventListener("click",(()=>{t(),a.classList.add("selected");const i=document.getElementById("selectedDMBar");if(i){i.innerHTML="";const e=document.createElement("h2");e.id="dmChannelTitle",e.className="dm-channel-title",e.textContent=n.username,i.appendChild(e)}o.e(774).then(o.bind(o,774)).then((t=>{t.initDMChat(e,n.username)})).catch((e=>console.error(e)))})),d.appendChild(a)})):d.appendChild(i("Engellenen arkadaşlar alınırken hata oluştu."))}))}}));const r=document.getElementById("toggleDMButton");function d(){const n=document.getElementById("dmPanel");if(!n)return void console.error("dmPanel not found");n.style.padding="0",n.innerHTML="";const i=document.createElement("div");i.className="dm-panel-header",n.appendChild(i);const r=document.createElement("input");r.type="text",r.placeholder="Bir konuşma bulun veya başlatın...",r.className="dm-search-input",r.addEventListener("input",(function(){const e=r.value.toLowerCase();n.querySelectorAll(".dm-friend-item").forEach((t=>{t.textContent.toLowerCase().indexOf(e)>-1?t.style.display="block":t.style.display="none"}))})),i.appendChild(r),n.appendChild(i);const d=document.createElement("button");d.innerHTML='<span class="material-icons dm-group-icon">group</span>Arkadaşlar',d.className="dm-friends-button",d.addEventListener("click",(()=>{t(),d.classList.add("selected");const e=document.getElementById("selectedDMBar");if(e){e.innerHTML="";const t=document.createElement("h2");t.id="dmChannelTitle",t.className="dm-channel-title",t.innerHTML='\n      <span class="dm-title-text">Arkadaşlar</span>\n      <span class="dm-divider"></span>\n      <span class="dm-filter-item" data-filter="online">Çevrimiçi</span>\n      <span class="dm-filter-item" data-filter="all">Hepsi</span>\n      <span class="dm-filter-item" data-filter="sent">Beklemede</span>\n      <span class="dm-filter-item" data-filter="blocked">Engellenen</span>\n      <span class="dm-filter-item" data-filter="add">Arkadaş ekle</span>\n    ',e.appendChild(t)}a().innerHTML=""})),n.appendChild(d),e.emit("getFriendsList",{},(a=>{if(a.success&&Array.isArray(a.friends))if(0===a.friends.length){const e=document.createElement("div");e.textContent="Hiç arkadaşınız yok.",e.style.padding="10px",n.appendChild(e)}else a.friends.forEach((a=>{const i=function(e){const t=document.createElement("div");t.classList.add("user-item","dm-friend-item"),t.style.cursor="pointer";const n=document.createElement("img");n.classList.add("user-profile-pic"),n.src="/images/default-avatar.png",n.alt="";const a=document.createElement("span");return a.classList.add("user-name"),a.textContent=e,a.style.marginLeft="8px",t.appendChild(n),t.appendChild(a),t}(a.username);i.addEventListener("click",(()=>{t(),i.classList.add("selected");const n=document.getElementById("selectedDMBar");if(n){n.innerHTML="";const e=document.createElement("h2");e.id="dmChannelTitle",e.className="dm-channel-title",e.textContent=a.username,n.appendChild(e)}o.e(774).then(o.bind(o,774)).then((t=>{t.initDMChat(e,a.username)})).catch((e=>console.error(e)))})),n.appendChild(i)}));else n.textContent="Arkadaşlar alınırken hata oluştu."}))}r&&r.addEventListener("click",(()=>{t(),d()}))}(Pe),Ue(),function(){const e=document.getElementById("attachBtn"),t=document.getElementById("attachmentPreview");_=document.getElementById("previewWrapper");const n=_?.querySelector(".main-media"),a=_?.querySelector(".thumbnail-tray");V=_?.querySelector(".caption-input");const o=_?.querySelector(".close-icon"),i=document.getElementById("textChannelContainer"),r={file:document.getElementById("attachFileInput"),media:document.getElementById("attachMediaInput"),audio:document.getElementById("attachAudioInput"),gif:document.getElementById("attachGifInput")};if(!e||!t)return;let d=null;function s(){t.innerHTML="",H.forEach(((e,n)=>{const a=document.createElement("div");let o;a.className="preview-item",a.dataset.index=n,a.tabIndex=0,e.file.type.startsWith("image/")?(o=document.createElement("img"),o.src=URL.createObjectURL(e.file)):e.file.type.startsWith("video/")?(o=document.createElement("span"),o.className="material-icons",o.textContent="movie"):e.file.type.startsWith("audio/")?(o=document.createElement("span"),o.className="material-icons",o.textContent="audiotrack"):(o=document.createElement("span"),o.className="material-icons",o.textContent="insert_drive_file"),a.appendChild(o);const i=document.createElement("span");i.className="remove-badge material-icons",i.textContent="close",i.addEventListener("click",(()=>{H.splice(n,1),s()})),a.appendChild(i);const r=document.createElement("div");r.className="upload-progress";const d=document.createElement("div");d.className="bar",r.appendChild(d),a.appendChild(r);const l=document.createElement("button");l.className="retry-btn",l.textContent="↻",l.style.display="none",a.appendChild(l),t.appendChild(a)})),t.style.display=H.length?"flex":"none",H.length&&!j?(j=function(n){const a=t.contains(n.target),o=_&&_.contains(n.target);a||o||n.target===e||(W(),document.removeEventListener("click",j),j=null)},document.addEventListener("click",j)):!H.length&&j&&(document.removeEventListener("click",j),j=null),_&&"none"!==_.style.display&&c()}function l(e,t){const n=document.createElement("div");n.className="file-card";const a=document.createElement("span");a.textContent=e.file.name,n.appendChild(a);const o=document.createElement("span");return o.className="remove-btn",o.textContent="×",o.addEventListener("click",(e=>{e.stopPropagation(),H.splice(t,1),O>=t&&(O=Math.max(O-1,0)),s(),c()})),n.appendChild(o),n}function c(){_&&(a.innerHTML="",H.slice(0,10).forEach(((e,t)=>{let n;e.file.type.startsWith("image/")?(n=document.createElement("img"),n.src=URL.createObjectURL(e.file)):e.file.type.startsWith("video/")?(n=document.createElement("video"),n.src=URL.createObjectURL(e.file),n.muted=!0):n=l(e,t),n.dataset.index=t,n.addEventListener("click",(()=>{O=t,u()})),a.appendChild(n)})),H.length?u():p())}function u(){if(!_)return;n.innerHTML="";const e=H[O];if(!e)return;let t;if(e.file.type.startsWith("image/"))t=document.createElement("img"),t.src=URL.createObjectURL(e.file);else if(e.file.type.startsWith("video/")){t=document.createElement("video"),t.controls=!0;const n=document.createElement("source");n.src=URL.createObjectURL(e.file),n.type=e.file.type,t.appendChild(n)}else t=l(e,O);n.appendChild(t)}function m(){if(!_)return;const e=document.getElementById("textMessages");O=0,c(),_.style.display="flex",e&&(e.style.display="none"),V&&V.focus();const t=document.getElementById("sendTextMessageBtn");t&&(t.style.display="block");const n=document.getElementById("micMessageBtn");n&&(n.style.display="none")}function p(){if(!_)return;_.style.display="none";const e=document.getElementById("textMessages");e&&(e.style.display="");const t=document.getElementById("textChannelMessageInput"),n=document.getElementById("sendTextMessageBtn"),a=document.getElementById("micMessageBtn");t&&n&&a&&(""===(0,z.os)(t).trim()?(n.style.display="none",a.style.display="block"):(n.style.display="block",a.style.display="none"))}function w(){d&&(d.remove(),document.removeEventListener("click",y),document.removeEventListener("keydown",g),d=null)}function y(t){d&&!d.contains(t.target)&&t.target!==e&&w()}function g(e){"Escape"===e.key&&w()}if(e.addEventListener("click",(t=>{t.stopPropagation(),function(){if(d)return void w();d=document.createElement("div"),d.id="attachmentMenu",d.className="context-menu",["file","media","audio","gif"].forEach((e=>{const t=document.createElement("div");t.className="context-menu-item",t.textContent=e,t.addEventListener("click",(()=>{r[e].click(),w()})),d.appendChild(t)}));const t=e.getBoundingClientRect();d.style.left=t.left+"px",d.style.bottom=window.innerHeight-t.top+8+"px",d.style.display="flex",document.body.appendChild(d),document.addEventListener("click",y),document.addEventListener("keydown",g)}()})),Object.keys(r).forEach((e=>{const t=r[e];t.addEventListener("change",(n=>{const a=Array.from(n.target.files),o=10-H.length;a.slice(0,o).forEach((t=>H.push({file:t,type:e}))),a.length>o&&alert("En fazla 10 dosya ekleyebilirsiniz."),t.value="",s(),m()}))})),i){const e=e=>e.preventDefault();i.addEventListener("dragenter",e),i.addEventListener("dragover",e),i.addEventListener("drop",(e=>{e.preventDefault();const t=e.dataTransfer;if(t&&t.files&&t.files.length){const e=Array.from(t.files),n=10-H.length;e.slice(0,n).forEach((e=>H.push({file:e,type:"file"}))),e.length>n&&alert("En fazla 10 dosya ekleyebilirsiniz."),s(),m()}}))}document.addEventListener("keydown",(e=>{const n=Array.from(t.querySelectorAll(".preview-item"));if(!e.altKey||"ArrowUp"!==e.key&&"ArrowDown"!==e.key)if("Delete"===e.key){const e=n.indexOf(document.activeElement);if(-1!==e){H.splice(e,1),s();const t=n[e]||n[e-1];t&&t.focus()}}else"Escape"===e.key&&(_&&"none"!==_.style.display?p():(w(),H.length&&W()));else{if(!n.length)return;e.preventDefault();let t=n.indexOf(document.activeElement);-1===t&&(t=0),t="ArrowDown"===e.key?(t+1)%n.length:(t-1+n.length)%n.length,n[t].focus()}})),o&&o.addEventListener("click",p)}();const n=document.getElementById("channelContentArea"),a=()=>{"voice"===window.currentRoomType&&window.latestChannelsData&&window.latestChannelsData[window.currentRoom]&&window.renderVoiceChannelGrid(window.latestChannelsData[window.currentRoom].users)};n&&("ResizeObserver"in window?(window.channelAreaResizeObserver=new ResizeObserver(a),window.channelAreaResizeObserver.observe(n)):(window.channelAreaResizeHandler=a,window.addEventListener("resize",window.channelAreaResizeHandler)));const i=Lt;let d;i&&i.addEventListener("scroll",(function(){i.scrollTop+i.clientHeight>=i.scrollHeight-5?d=setTimeout((()=>{i.scrollTop+i.clientHeight>=i.scrollHeight-5&&i.classList.remove("scrolling")}),1e3):(clearTimeout(d),i.classList.add("scrolling"))})),r.w(Pe,Lt),document.addEventListener("click",(function(e){if(e.target&&e.target.classList.contains("dm-filter-item")){const t=e.target.getAttribute("data-filter");console.info("DM Filter clicked: "+t)}}))})),window.showMuteSubMenu=on,window.showNotificationSubMenu=rn,window.showChannelContextMenu=function(e,t){const n=document.getElementById("channelContextMenu");n&&n.remove();const a=document.createElement("div");a.id="channelContextMenu",a.className="context-menu",a.style.position="absolute",a.style.top=e.pageY+"px",a.style.left=e.pageX+"px",a.style.display="flex",a.style.flexDirection="column";let o=0;window.latestChannelsData&&(o=Object.values(window.latestChannelsData).filter((e=>"text"===e.type)).length);const i=window.channelMuteUntil[window.selectedGroup]&&window.channelMuteUntil[window.selectedGroup][t.id];[{text:"Kanal Ayarları",action:()=>{alert("Kanal ayarları henüz uygulanmadı.")}},i&&Date.now()<i?{text:"Bu kanalın sesini aç",action:()=>{Pe.emit("muteChannel",{groupId:window.selectedGroup,channelId:t.id,duration:0})}}:{text:"Bu kanalı sessize al",mute:!0,action:()=>{}},{text:"Bildirim türü",notification:!0,action:()=>{}},{text:"Kanalın İsmini Değiştir",action:()=>{const e=prompt("Yeni kanal ismini girin:",t.name);e&&""!==e.trim()&&Pe.emit("renameChannel",{channelId:t.id,newName:e.trim()})}},{text:"Kanalı Sil",hide:"text"===t.type&&1===o,action:()=>{confirm("Bu kanalı silmek istediğinize emin misiniz?")&&Pe.emit("deleteChannel",t.id)}}].forEach((e=>{if(e.hide)return;const n=document.createElement("div");if(n.className="context-menu-item",e.mute){const a=document.createElement("span");a.textContent=e.text;const o=document.createElement("span");o.classList.add("material-icons"),o.textContent="chevron_right",n.appendChild(a),n.appendChild(o),n.dataset.channelId=t.id,n.addEventListener("mouseenter",(()=>on(n,"channel")))}else if(e.notification){const a=document.createElement("span");a.textContent=e.text;const o=document.createElement("span");o.classList.add("material-icons"),o.textContent="chevron_right",n.appendChild(a),n.appendChild(o),n.dataset.channelId=t.id,n.addEventListener("mouseenter",(()=>rn(n,"channel")))}else n.textContent=e.text,n.addEventListener("click",(()=>{e.action(),a.remove()}));a.appendChild(n)})),document.body.appendChild(a),document.addEventListener("click",(function e(){document.getElementById("channelContextMenu")&&document.getElementById("channelContextMenu").remove(),document.removeEventListener("click",e)}))},window.showCategoryContextMenu=function(e,t){const n=document.getElementById("categoryContextMenu");n&&n.remove();const a=document.createElement("div");a.id="categoryContextMenu",a.className="context-menu",a.style.position="absolute",a.style.top=e.pageY+"px",a.style.left=e.pageX+"px",a.style.display="flex",a.style.flexDirection="column";const o=window.categoryMuteUntil[window.selectedGroup]&&window.categoryMuteUntil[window.selectedGroup][t.id];[{text:"Kategori ayarları",action:()=>{alert("Kategori ayarları henüz uygulanmadı.")}},o&&Date.now()<o?{text:"Bu kategorinin sesini aç",action:()=>{Pe.emit("muteCategory",{groupId:window.selectedGroup,categoryId:t.id,duration:0})}}:{text:"Bu kategoriyi sessize al",mute:!0,action:()=>{}},{text:"Bildirim türü",notification:!0,action:()=>{}},{text:"Kategorinin ismini değiştir",action:()=>{const e=prompt("Yeni kategori ismini girin:",t.name);e&&""!==e.trim()&&Pe.emit("renameCategory",{categoryId:t.id,newName:e.trim()})}},{text:"Kategoriyi sil",action:()=>{confirm("Bu kategoriyi silmek istediğinize emin misiniz?")&&Pe.emit("deleteCategory",t.id)}}].forEach((e=>{const n=document.createElement("div");if(n.className="context-menu-item",e.mute){const a=document.createElement("span");a.textContent=e.text;const o=document.createElement("span");o.classList.add("material-icons"),o.textContent="chevron_right",n.appendChild(a),n.appendChild(o),n.dataset.categoryId=t.id,n.addEventListener("mouseenter",(()=>on(n,"category")))}else if(e.notification){const t=document.createElement("span");t.textContent=e.text;const a=document.createElement("span");a.classList.add("material-icons"),a.textContent="chevron_right",n.appendChild(t),n.appendChild(a)}else n.textContent=e.text,n.addEventListener("click",(()=>{e.action(),a.remove()}));a.appendChild(n)})),document.body.appendChild(a),document.addEventListener("click",(function e(){const t=document.getElementById("categoryContextMenu");t&&t.remove(),document.removeEventListener("click",e)}))},window.showGroupContextMenu=function(e,t){const n=document.getElementById("groupContextMenu");n&&n.remove();const a=document.createElement("div");a.id="groupContextMenu",a.className="context-menu",a.style.position="absolute",a.style.top=e.pageY+"px",a.style.left=e.pageX+"px",a.style.display="flex",a.style.flexDirection="column";const o=window.groupMuteUntil[t.id];[{text:"Grup ID Kopyala",action:()=>navigator.clipboard.writeText(t.id)},o&&Date.now()<o?{text:"Bu grubun sesini aç",action:()=>{Pe.emit("muteGroup",{groupId:t.id,duration:0})}}:{text:"Bu grubu sessize al",mute:!0,action:()=>{}},{text:"Bildirim türü",notification:!0,action:()=>{}},{text:"Gruptan Ayrıl",hide:t.owner===window.username,action:()=>{Pe.emit("leaveGroup",t.id)}}].forEach((e=>{if(e.hide)return;const n=document.createElement("div");if(n.className="context-menu-item",e.mute){const a=document.createElement("span");a.textContent=e.text;const o=document.createElement("span");o.classList.add("material-icons"),o.textContent="chevron_right",n.appendChild(a),n.appendChild(o),n.dataset.groupId=t.id,n.addEventListener("mouseenter",(()=>on(n,"group")))}else if(e.notification){const a=document.createElement("span");a.textContent=e.text;const o=document.createElement("span");o.classList.add("material-icons"),o.textContent="chevron_right",n.appendChild(a),n.appendChild(o),n.dataset.groupId=t.id,n.addEventListener("mouseenter",(()=>rn(n,"group")))}else n.textContent=e.text,n.addEventListener("click",(()=>{e.action(),a.remove()}));a.appendChild(n)})),document.body.appendChild(a),document.addEventListener("click",(function e(){const t=document.getElementById("groupContextMenu");t&&t.remove(),document.removeEventListener("click",e)}))},window.showVideoContextMenu=function(e){if(e.preventDefault(),!x)return;const t=document.getElementById("videoContextMenu");t&&t.remove();const n=document.createElement("div");n.id="videoContextMenu",n.className="context-menu",n.style.position="absolute",n.style.top=e.pageY+"px",n.style.left=e.pageX+"px",n.style.display="flex",n.style.flexDirection="column";const a=x.dataset.peerId,o=k.find((e=>e.dataset.peerId===a));if(o){const e=document.createElement("div");e.className="context-menu-item";const t=document.createElement("input");t.type="range",t.min="0",t.max="1",t.step="0.01",t.value=o.volume,t.addEventListener("input",(()=>{o.volume=parseFloat(t.value)})),e.textContent="Ses: ",e.appendChild(t),n.appendChild(e)}document.body.appendChild(n),document.addEventListener("click",(function e(){const t=document.getElementById("videoContextMenu");t&&t.remove(),document.removeEventListener("click",e)}))},window.updateVoiceChannelUI=function(e,t=!1){xt.textContent=e;const n=document.getElementById("channelUsersContainer");n&&(n.style.display="grid"),Ct.style.display="none",t?(nt&&(nt.style.display="flex"),lt()):mt()},window.showScreenShare=function(e){$(Pe,null,null,e,De)},window.displayScreenShareEndedMessage=function(e){document.querySelector(".channel-content-area");let t=document.getElementById("screenShareEndedMessage");t||(t=document.createElement("div"),t.id="screenShareEndedMessage",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="#fff",t.style.backgroundColor="rgba(0,0,0,0.7)",t.style.padding="1rem",t.style.borderRadius="8px",t.style.fontSize="1.2rem"),t.textContent=e||"Bu yayın sonlandırıldı",document.querySelector(".channel-content-area").appendChild(t)},window.removeScreenShareEndedMessage=function(){const e=document.getElementById("screenShareEndedMessage");e&&e.parentNode&&e.parentNode.removeChild(e)},window.openUserSettings=function(){const e=document.getElementById("userSettingsPage"),t=document.getElementById("callScreen");e&&(e.style.display="block",Ue()),t&&(t.style.display="none")},window.closeUserSettings=Ne})();